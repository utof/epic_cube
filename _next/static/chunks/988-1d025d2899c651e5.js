"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[988],{830:(e,t,r)=>{r.d(t,{$:()=>u});var n=r(9630),a=r(3264),i=r(2115),o=r(1949);function s(e,t,r){let n=(0,o.C)(e=>e.size),s=(0,o.C)(e=>e.viewport),l="number"==typeof e?e:n.width*s.dpr,c="number"==typeof t?t:n.height*s.dpr,u=("number"==typeof e?r:e)||{},{samples:f=0,depth:d,...p}=u,h=null!=d?d:u.depthBuffer,m=i.useMemo(()=>{let e=new a.nWS(l,c,{minFilter:a.k6q,magFilter:a.k6q,type:a.ix0,...p});return h&&(e.depthTexture=new a.VCu(l,c,a.RQf)),e.samples=f,e},[]);return i.useLayoutEffect(()=>{m.setSize(l,c),f&&(m.samples=f)},[f,m,l,c]),i.useEffect(()=>()=>m.dispose(),[]),m}let l=function(e,t,r,n){var i;return(i=class extends a.BKk{constructor(n){for(let i in super({vertexShader:t,fragmentShader:r,...n}),e)this.uniforms[i]=new a.nc$(e[i]),Object.defineProperty(this,i,{get(){return this.uniforms[i].value},set(e){this.uniforms[i].value=e}});this.uniforms=a.LlO.clone(this.uniforms)}}).key=a.cj9.generateUUID(),i}({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");class c extends a.uSd{constructor(e=6,t=!1){super(),this.uniforms={chromaticAberration:{value:.05},transmission:{value:0},_transmission:{value:1},transmissionMap:{value:null},roughness:{value:0},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:1/0},attenuationColor:{value:new a.Q1f("white")},anisotropicBlur:{value:.1},time:{value:0},distortion:{value:0},distortionScale:{value:.5},temporalDistortion:{value:0},buffer:{value:null}},this.onBeforeCompile=r=>{r.uniforms={...r.uniforms,...this.uniforms},this.anisotropy>0&&(r.defines.USE_ANISOTROPY=""),t?r.defines.USE_SAMPLER="":r.defines.USE_TRANSMISSION="",r.fragmentShader=`
      uniform float chromaticAberration;         
      uniform float anisotropicBlur;      
      uniform float time;
      uniform float distortion;
      uniform float distortionScale;
      uniform float temporalDistortion;
      uniform sampler2D buffer;

      vec3 random3(vec3 c) {
        float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
        vec3 r;
        r.z = fract(512.0*j);
        j *= .125;
        r.x = fract(512.0*j);
        j *= .125;
        r.y = fract(512.0*j);
        return r-0.5;
      }

      uint hash( uint x ) {
        x += ( x << 10u );
        x ^= ( x >>  6u );
        x += ( x <<  3u );
        x ^= ( x >> 11u );
        x += ( x << 15u );
        return x;
      }

      // Compound versions of the hashing algorithm I whipped together.
      uint hash( uvec2 v ) { return hash( v.x ^ hash(v.y)                         ); }
      uint hash( uvec3 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z)             ); }
      uint hash( uvec4 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z) ^ hash(v.w) ); }

      // Construct a float with half-open range [0:1] using low 23 bits.
      // All zeroes yields 0.0, all ones yields the next smallest representable value below 1.0.
      float floatConstruct( uint m ) {
        const uint ieeeMantissa = 0x007FFFFFu; // binary32 mantissa bitmask
        const uint ieeeOne      = 0x3F800000u; // 1.0 in IEEE binary32
        m &= ieeeMantissa;                     // Keep only mantissa bits (fractional part)
        m |= ieeeOne;                          // Add fractional part to 1.0
        float  f = uintBitsToFloat( m );       // Range [1:2]
        return f - 1.0;                        // Range [0:1]
      }

      // Pseudo-random value in half-open range [0:1].
      float randomBase( float x ) { return floatConstruct(hash(floatBitsToUint(x))); }
      float randomBase( vec2  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec3  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec4  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float rand(float seed) {
        float result = randomBase(vec3(gl_FragCoord.xy, seed));
        return result;
      }

      const float F3 =  0.3333333;
      const float G3 =  0.1666667;

      float snoise(vec3 p) {
        vec3 s = floor(p + dot(p, vec3(F3)));
        vec3 x = p - s + dot(s, vec3(G3));
        vec3 e = step(vec3(0.0), x - x.yzx);
        vec3 i1 = e*(1.0 - e.zxy);
        vec3 i2 = 1.0 - e.zxy*(1.0 - e);
        vec3 x1 = x - i1 + G3;
        vec3 x2 = x - i2 + 2.0*G3;
        vec3 x3 = x - 1.0 + 3.0*G3;
        vec4 w, d;
        w.x = dot(x, x);
        w.y = dot(x1, x1);
        w.z = dot(x2, x2);
        w.w = dot(x3, x3);
        w = max(0.6 - w, 0.0);
        d.x = dot(random3(s), x);
        d.y = dot(random3(s + i1), x1);
        d.z = dot(random3(s + i2), x2);
        d.w = dot(random3(s + 1.0), x3);
        w *= w;
        w *= w;
        d *= w;
        return dot(d, vec4(52.0));
      }

      float snoiseFractal(vec3 m) {
        return 0.5333333* snoise(m)
              +0.2666667* snoise(2.0*m)
              +0.1333333* snoise(4.0*m)
              +0.0666667* snoise(8.0*m);
      }
`+r.fragmentShader,r.fragmentShader=r.fragmentShader.replace("#include <transmission_pars_fragment>",`
        #ifdef USE_TRANSMISSION
          // Transmission code is based on glTF-Sampler-Viewer
          // https://github.com/KhronosGroup/glTF-Sample-Viewer
          uniform float _transmission;
          uniform float thickness;
          uniform float attenuationDistance;
          uniform vec3 attenuationColor;
          #ifdef USE_TRANSMISSIONMAP
            uniform sampler2D transmissionMap;
          #endif
          #ifdef USE_THICKNESSMAP
            uniform sampler2D thicknessMap;
          #endif
          uniform vec2 transmissionSamplerSize;
          uniform sampler2D transmissionSamplerMap;
          uniform mat4 modelMatrix;
          uniform mat4 projectionMatrix;
          varying vec3 vWorldPosition;
          vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
            // Direction of refracted light.
            vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
            // Compute rotation-independant scaling of the model matrix.
            vec3 modelScale;
            modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
            modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
            modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
            // The thickness is specified in local space.
            return normalize( refractionVector ) * thickness * modelScale;
          }
          float applyIorToRoughness( const in float roughness, const in float ior ) {
            // Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
            // an IOR of 1.5 results in the default amount of microfacet refraction.
            return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
          }
          vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
            float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );            
            #ifdef USE_SAMPLER
              #ifdef texture2DLodEXT
                return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #else
                return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #endif
            #else
              return texture2D(buffer, fragCoord.xy);
            #endif
          }
          vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
            if ( isinf( attenuationDistance ) ) {
              // Attenuation distance is +âˆž, i.e. the transmitted color is not attenuated at all.
              return radiance;
            } else {
              // Compute light attenuation using Beer's law.
              vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
              vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law
              return transmittance * radiance;
            }
          }
          vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
            const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
            const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
            const in vec3 attenuationColor, const in float attenuationDistance ) {
            vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
            vec3 refractedRayExit = position + transmissionRay;
            // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
            vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
            vec2 refractionCoords = ndcPos.xy / ndcPos.w;
            refractionCoords += 1.0;
            refractionCoords /= 2.0;
            // Sample framebuffer to get pixel the refracted ray hits.
            vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
            vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
            // Get the specular component.
            vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
            return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
          }
        #endif
`),r.fragmentShader=r.fragmentShader.replace("#include <transmission_fragment>",`  
        // Improve the refraction to use the world pos
        material.transmission = _transmission;
        material.transmissionAlpha = 1.0;
        material.thickness = thickness;
        material.attenuationDistance = attenuationDistance;
        material.attenuationColor = attenuationColor;
        #ifdef USE_TRANSMISSIONMAP
          material.transmission *= texture2D( transmissionMap, vUv ).r;
        #endif
        #ifdef USE_THICKNESSMAP
          material.thickness *= texture2D( thicknessMap, vUv ).g;
        #endif
        
        vec3 pos = vWorldPosition;
        float runningSeed = 0.0;
        vec3 v = normalize( cameraPosition - pos );
        vec3 n = inverseTransformDirection( normal, viewMatrix );
        vec3 transmission = vec3(0.0);
        float transmissionR, transmissionB, transmissionG;
        float randomCoords = rand(runningSeed++);
        float thickness_smear = thickness * max(pow(roughnessFactor, 0.33), anisotropicBlur);
        vec3 distortionNormal = vec3(0.0);
        vec3 temporalOffset = vec3(time, -time, -time) * temporalDistortion;
        if (distortion > 0.0) {
          distortionNormal = distortion * vec3(snoiseFractal(vec3((pos * distortionScale + temporalOffset))), snoiseFractal(vec3(pos.zxy * distortionScale - temporalOffset)), snoiseFractal(vec3(pos.yxz * distortionScale + temporalOffset)));
        }
        for (float i = 0.0; i < ${e}.0; i ++) {
          vec3 sampleNorm = normalize(n + roughnessFactor * roughnessFactor * 2.0 * normalize(vec3(rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5)) * pow(rand(runningSeed++), 0.33) + distortionNormal);
          transmissionR = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness  + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).r;
          transmissionG = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior  * (1.0 + chromaticAberration * (i + randomCoords) / float(${e})) , material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).g;
          transmissionB = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior * (1.0 + 2.0 * chromaticAberration * (i + randomCoords) / float(${e})), material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).b;
          transmission.r += transmissionR;
          transmission.g += transmissionG;
          transmission.b += transmissionB;
        }
        transmission /= ${e}.0;
        totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
`)},Object.keys(this.uniforms).forEach(e=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t}))}}let u=i.forwardRef(({buffer:e,transmissionSampler:t=!1,backside:r=!1,side:u=a.hB5,transmission:f=1,thickness:d=0,backsideThickness:p=0,backsideEnvMapIntensity:h=1,samples:m=10,resolution:v,backsideResolution:g,background:w,anisotropy:y,anisotropicBlur:b,...x},M)=>{let S,_,C,E;(0,o.e)({MeshTransmissionMaterial:c});let P=i.useRef(null),[R]=i.useState(()=>new l),k=s(g||v),j=s(v);return(0,o.D)(e=>{if(P.current.time=e.clock.elapsedTime,P.current.buffer===j.texture&&!t){var n;(E=null==(n=P.current.__r3f.parent)?void 0:n.object)&&(C=e.gl.toneMapping,S=e.scene.background,_=P.current.envMapIntensity,e.gl.toneMapping=a.y_p,w&&(e.scene.background=w),E.material=R,r&&(e.gl.setRenderTarget(k),e.gl.render(e.scene,e.camera),E.material=P.current,E.material.buffer=k.texture,E.material.thickness=p,E.material.side=a.hsX,E.material.envMapIntensity=h),e.gl.setRenderTarget(j),e.gl.render(e.scene,e.camera),E.material=P.current,E.material.thickness=d,E.material.side=u,E.material.buffer=j.texture,E.material.envMapIntensity=_,e.scene.background=S,e.gl.setRenderTarget(null),e.gl.toneMapping=C)}}),i.useImperativeHandle(M,()=>P.current,[]),i.createElement("meshTransmissionMaterial",(0,n.A)({args:[m,t],ref:P},x,{buffer:e||j.texture,_transmission:f,anisotropicBlur:null!=b?b:y,transmission:t?f:0,thickness:d,side:u}))})},1933:(e,t,r)=>{e.exports=r(6500)},1949:(e,t,r)=>{let n,a,i,o,s;r.d(t,{B:()=>T,C:()=>er,D:()=>en,E:()=>A,G:()=>eo,a:()=>j,b:()=>k,c:()=>eE,d:()=>eR,e:()=>ef,f:()=>eq,i:()=>P,o:()=>ek,s:()=>V,u:()=>I});var l=r(3264),c=r(7431),u=r(2115),f=r.t(u,2),d=r(1933),p=r(5643);let h=e=>{let t,r=new Set,n=(e,n)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=n?n:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,i={setState:n,getState:a,getInitialState:()=>o,subscribe:e=>(r.add(e),()=>r.delete(e))},o=t=e(n,a,i);return i},{useSyncExternalStoreWithSelector:m}=p,v=(e,t)=>{let r=(e=>e?h(e):h)(e),n=(e,n=t)=>(function(e,t=e=>e,r){let n=m(e.subscribe,e.getState,e.getInitialState,t,r);return u.useDebugValue(n),n})(r,e,n);return Object.assign(n,r),n},g=(e,t)=>e?v(e,t):v;var w=r(5220),y=r.n(w),b=r(2407);let x=[];function M(e,t,r=(e,t)=>e===t){if(e===t)return!0;if(!e||!t)return!1;let n=e.length;if(t.length!==n)return!1;for(let a=0;a<n;a++)if(!r(e[a],t[a]))return!1;return!0}function S(e,t=null,r=!1,n={}){for(let a of(null===t&&(t=[e]),x))if(M(t,a.keys,a.equal)){if(r)return;if(Object.prototype.hasOwnProperty.call(a,"error"))throw a.error;if(Object.prototype.hasOwnProperty.call(a,"response"))return n.lifespan&&n.lifespan>0&&(a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout(a.remove,n.lifespan)),a.response;if(!r)throw a.promise}let a={keys:t,equal:n.equal,remove:()=>{let e=x.indexOf(a);-1!==e&&x.splice(e,1)},promise:("object"==typeof e&&"function"==typeof e.then?e:e(...t)).then(e=>{a.response=e,n.lifespan&&n.lifespan>0&&(a.timeout=setTimeout(a.remove,n.lifespan))}).catch(e=>a.error=e)};if(x.push(a),!r)throw a.promise}var _=r(5155),C=r(6354);function E(e){let t=e.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}r(9509),f.act;let P=e=>e&&e.hasOwnProperty("current"),R=e=>null!=e&&("string"==typeof e||"number"==typeof e||e.isColor),k=((e,t)=>"undefined"!=typeof window&&((null==(e=window.document)?void 0:e.createElement)||(null==(t=window.navigator)?void 0:t.product)==="ReactNative"))()?u.useLayoutEffect:u.useEffect;function j(e){let t=u.useRef(e);return k(()=>void(t.current=e),[e]),t}function I(){let e=(0,C.u5)(),t=(0,C.y3)();return u.useMemo(()=>({children:r})=>{let n=(0,C.Nz)(e,!0,e=>e.type===u.StrictMode)?u.StrictMode:u.Fragment;return(0,_.jsx)(n,{children:(0,_.jsx)(t,{children:r})})},[e,t])}function T({set:e}){return k(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}let A=(e=>((e=class extends u.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}).getDerivedStateFromError=()=>({error:!0}),e))();function O(e){var t;let r="undefined"!=typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}function F(e){var t;return null==(t=e.__r3f)?void 0:t.root.getState()}let U={obj:e=>e===Object(e)&&!U.arr(e)&&"function"!=typeof e,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,boo:e=>"boolean"==typeof e,und:e=>void 0===e,nul:e=>null===e,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:n="reference",strict:a=!0}={}){let i;if(typeof e!=typeof t||!!e!=!!t)return!1;if(U.str(e)||U.num(e)||U.boo(e))return e===t;let o=U.obj(e);if(o&&"reference"===n)return e===t;let s=U.arr(e);if(s&&"reference"===r)return e===t;if((s||o)&&e===t)return!0;for(i in e)if(!(i in t))return!1;if(o&&"shallow"===r&&"shallow"===n){for(i in a?t:e)if(!U.equ(e[i],t[i],{strict:a,objects:"reference"}))return!1}else for(i in a?t:e)if(e[i]!==t[i])return!1;if(U.und(i)){if(s&&0===e.length&&0===t.length||o&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}},z=["children","key","ref"];function D(e,t,r,n){let a=null==e?void 0:e.__r3f;return!a&&(a={root:t,type:r,parent:null,children:[],props:function(e){let t={};for(let r in e)z.includes(r)||(t[r]=e[r]);return t}(n),object:e,eventCount:0,handlers:{},isHidden:!1},e&&(e.__r3f=a)),a}function B(e,t){let r=e[t];if(!t.includes("-"))return{root:e,key:t,target:r};for(let a of(r=e,t.split("-"))){var n;t=a,e=r,r=null==(n=r)?void 0:n[t]}return{root:e,key:t,target:r}}let L=/-\d+$/;function N(e,t){if(U.str(t.props.attach)){if(L.test(t.props.attach)){let r=t.props.attach.replace(L,""),{root:n,key:a}=B(e.object,r);Array.isArray(n[a])||(n[a]=[])}let{root:r,key:n}=B(e.object,t.props.attach);t.previousAttach=r[n],r[n]=t.object}else U.fun(t.props.attach)&&(t.previousAttach=t.props.attach(e.object,t.object))}function H(e,t){if(U.str(t.props.attach)){let{root:r,key:n}=B(e.object,t.props.attach),a=t.previousAttach;void 0===a?delete r[n]:r[n]=a}else null==t.previousAttach||t.previousAttach(e.object,t.object);delete t.previousAttach}let q=[...z,"args","dispose","attach","object","onUpdate","dispose"],G=new Map,W=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],$=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function V(e,t){var r,n;let a=e.__r3f,i=a&&E(a).getState(),o=null==a?void 0:a.eventCount;for(let r in t){let o=t[r];if(q.includes(r))continue;if(a&&$.test(r)){"function"==typeof o?a.handlers[r]=o:delete a.handlers[r],a.eventCount=Object.keys(a.handlers).length;continue}if(void 0===o)continue;let{root:s,key:c,target:u}=B(e,r);u instanceof l.zgK&&o instanceof l.zgK?u.mask=o.mask:u instanceof l.Q1f&&R(o)?u.set(o):null!==u&&"object"==typeof u&&"function"==typeof u.set&&"function"==typeof u.copy&&null!=o&&o.constructor&&u.constructor===o.constructor?u.copy(o):null!==u&&"object"==typeof u&&"function"==typeof u.set&&Array.isArray(o)?"function"==typeof u.fromArray?u.fromArray(o):u.set(...o):null!==u&&"object"==typeof u&&"function"==typeof u.set&&"number"==typeof o?"function"==typeof u.setScalar?u.setScalar(o):u.set(o):(s[c]=o,i&&!i.linear&&W.includes(c)&&null!=(n=s[c])&&n.isTexture&&s[c].format===l.GWd&&s[c].type===l.OUM&&(s[c].colorSpace=l.er$))}if(null!=a&&a.parent&&null!=i&&i.internal&&null!=(r=a.object)&&r.isObject3D&&o!==a.eventCount){let e=a.object,t=i.internal.interaction.indexOf(e);t>-1&&i.internal.interaction.splice(t,1),a.eventCount&&null!==e.raycast&&i.internal.interaction.push(e)}return a&&void 0===a.props.attach&&(a.object.isBufferGeometry?a.props.attach="geometry":a.object.isMaterial&&(a.props.attach="material")),a&&Y(a),e}function Y(e){var t;if(!e.parent)return;null==e.props.onUpdate||e.props.onUpdate(e.object);let r=null==(t=e.root)||null==t.getState?void 0:t.getState();r&&0===r.internal.frames&&r.invalidate()}function X(e,t){!e.manual&&(e&&e.isOrthographicCamera?(e.left=-(t.width/2),e.right=t.width/2,e.top=t.height/2,e.bottom=-(t.height/2)):e.aspect=t.width/t.height,e.updateProjectionMatrix())}let Z=e=>null==e?void 0:e.isObject3D;function Q(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function K(e,t,r,n){let a=r.get(t);a&&(r.delete(t),0===r.size&&(e.delete(n),a.target.releasePointerCapture(n)))}let J=e=>!!(null!=e&&e.render),ee=u.createContext(null);function et(){let e=u.useContext(ee);if(!e)throw Error("R3F: Hooks can only be used within the Canvas component!");return e}function er(e=e=>e,t){return et()(e,t)}function en(e,t=0){let r=et(),n=r.getState().internal.subscribe,a=j(e);return k(()=>n(a,t,r),[t,n,r]),null}let ea=new WeakMap;function ei(e,t){return function(r,...n){var a;let i;return"function"==typeof r&&(null==r||null==(a=r.prototype)?void 0:a.constructor)===r?(i=ea.get(r))||(i=new r,ea.set(r,i)):i=r,e&&e(i),Promise.all(n.map(e=>new Promise((r,n)=>i.load(e,e=>{Z(null==e?void 0:e.scene)&&Object.assign(e,function(e){let t={nodes:{},materials:{},meshes:{}};return e&&e.traverse(e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material),e.isMesh&&!t.meshes[e.name]&&(t.meshes[e.name]=e)}),t}(e.scene)),r(e)},t,t=>n(Error(`Could not load ${e}: ${null==t?void 0:t.message}`))))))}}function eo(e,t,r,n){let a=Array.isArray(t)?t:[t],i=S(ei(r,n),[e,...a],!1,{equal:U.equ});return Array.isArray(t)?i:i[0]}eo.preload=function(e,t,r){let n,a=Array.isArray(t)?t:[t];S(ei(r),[e,...a],!0,n)},eo.clear=function(e,t){var r=[e,...Array.isArray(t)?t:[t]];if(void 0===r||0===r.length)x.splice(0,x.length);else{let e=x.find(e=>M(r,e.keys,e.equal));e&&e.remove()}};let es={},el=/^three(?=[A-Z])/,ec=e=>`${e[0].toUpperCase()}${e.slice(1)}`,eu=0;function ef(e){if("function"==typeof e){let t=`${eu++}`;return es[t]=e,t}Object.assign(es,e)}function ed(e,t){let r=ec(e),n=es[r];if("primitive"!==e&&!n)throw Error(`R3F: ${r} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if("primitive"===e&&!t.object)throw Error("R3F: Primitives without 'object' are invalid!");if(void 0!==t.args&&!Array.isArray(t.args))throw Error("R3F: The args prop must be an array!")}function ep(e){if(e.isHidden){var t;e.props.attach&&null!=(t=e.parent)&&t.object?N(e.parent,e):Z(e.object)&&!1!==e.props.visible&&(e.object.visible=!0),e.isHidden=!1,Y(e)}}function eh(e,t,r){let n=t.root.getState();if(e.parent||e.object===n.scene){if(!t.object){var a,i;let e=es[ec(t.type)];t.object=null!=(a=t.props.object)?a:new e(...null!=(i=t.props.args)?i:[]),t.object.__r3f=t}if(V(t.object,t.props),t.props.attach)N(e,t);else if(Z(t.object)&&Z(e.object)){let n=e.object.children.indexOf(null==r?void 0:r.object);if(r&&-1!==n){let r=e.object.children.indexOf(t.object);-1!==r?(e.object.children.splice(r,1),e.object.children.splice(r<n?n-1:n,0,t.object)):(t.object.parent=e.object,e.object.children.splice(n,0,t.object),t.object.dispatchEvent({type:"added"}),e.object.dispatchEvent({type:"childadded",child:t.object}))}else e.object.add(t.object)}for(let e of t.children)eh(t,e);Y(t)}}function em(e,t){t&&(t.parent=e,e.children.push(t),eh(e,t))}function ev(e,t,r){if(!t||!r)return;t.parent=e;let n=e.children.indexOf(r);-1!==n?e.children.splice(n,0,t):e.children.push(t),eh(e,t,r)}function eg(e){if("function"==typeof e.dispose){let t=()=>{try{e.dispose()}catch{}};"undefined"!=typeof IS_REACT_ACT_ENVIRONMENT?t():(0,b.unstable_scheduleCallback)(b.unstable_IdlePriority,t)}}function ew(e,t,r){if(!t)return;t.parent=null;let n=e.children.indexOf(t);-1!==n&&e.children.splice(n,1),t.props.attach?H(e,t):Z(t.object)&&Z(e.object)&&(e.object.remove(t.object),function(e,t){let{internal:r}=e.getState();r.interaction=r.interaction.filter(e=>e!==t),r.initialHits=r.initialHits.filter(e=>e!==t),r.hovered.forEach((e,n)=>{(e.eventObject===t||e.object===t)&&r.hovered.delete(n)}),r.capturedMap.forEach((e,n)=>{K(r.capturedMap,t,e,n)})}(E(t),t.object));let a=null!==t.props.dispose&&!1!==r;for(let e=t.children.length-1;e>=0;e--){let r=t.children[e];ew(t,r,a)}t.children.length=0,delete t.object.__r3f,a&&"primitive"!==t.type&&"Scene"!==t.object.type&&eg(t.object),void 0===r&&Y(t)}let ey=[],eb=()=>{},ex={},eM=0,eS=function(e){let t=y()(e);return t.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:u.version}),t}({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:function(e,t,r){var n;return ed(e=ec(e)in es?e:e.replace(el,""),t),"primitive"===e&&null!=(n=t.object)&&n.__r3f&&delete t.object.__r3f,D(t.object,r,e,t)},removeChild:ew,appendChild:em,appendInitialChild:em,insertBefore:ev,appendChildToContainer(e,t){let r=e.getState().scene.__r3f;t&&r&&em(r,t)},removeChildFromContainer(e,t){let r=e.getState().scene.__r3f;t&&r&&ew(r,t)},insertInContainerBefore(e,t,r){let n=e.getState().scene.__r3f;t&&r&&n&&ev(n,t,r)},getRootHostContext:()=>ex,getChildHostContext:()=>ex,commitUpdate(e,t,r,n,a){var i,o,s;ed(t,n);let l=!1;if("primitive"===e.type&&r.object!==n.object||(null==(i=n.args)?void 0:i.length)!==(null==(o=r.args)?void 0:o.length)?l=!0:null!=(s=n.args)&&s.some((e,t)=>{var n;return e!==(null==(n=r.args)?void 0:n[t])})&&(l=!0),l)ey.push([e,{...n},a]);else{let t=function(e,t){let r={};for(let n in t)if(!q.includes(n)&&!U.equ(t[n],e.props[n]))for(let e in r[n]=t[n],t)e.startsWith(`${n}-`)&&(r[e]=t[e]);for(let n in e.props){if(q.includes(n)||t.hasOwnProperty(n))continue;let{root:a,key:i}=B(e.object,n);if(a.constructor&&0===a.constructor.length){let e=function(e){let t=G.get(e.constructor);try{t||(t=new e.constructor,G.set(e.constructor,t))}catch(e){}return t}(a);U.und(e)||(r[i]=e[i])}else r[i]=0}return r}(e,n);Object.keys(t).length&&(Object.assign(e.props,t),V(e.object,t))}(null===a.sibling||(4&a.flags)==0)&&function(){for(let[e]of ey){let t=e.parent;if(t)for(let r of(e.props.attach?H(t,e):Z(e.object)&&Z(t.object)&&t.object.remove(e.object),e.children))r.props.attach?H(e,r):Z(r.object)&&Z(e.object)&&e.object.remove(r.object);e.isHidden&&ep(e),e.object.__r3f&&delete e.object.__r3f,"primitive"!==e.type&&eg(e.object)}for(let[n,a,i]of ey){n.props=a;let o=n.parent;if(o){let a=es[ec(n.type)];n.object=null!=(e=n.props.object)?e:new a(...null!=(t=n.props.args)?t:[]),n.object.__r3f=n;var e,t,r=n.object;for(let e of[i,i.alternate])if(null!==e)if("function"==typeof e.ref){null==e.refCleanup||e.refCleanup();let t=e.ref(r);"function"==typeof t&&(e.refCleanup=t)}else e.ref&&(e.ref.current=r);for(let e of(V(n.object,n.props),n.props.attach?N(o,n):Z(n.object)&&Z(o.object)&&o.object.add(n.object),n.children))e.props.attach?N(n,e):Z(e.object)&&Z(n.object)&&n.object.add(e.object);Y(n)}}ey.length=0}()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:e=>null==e?void 0:e.object,prepareForCommit:()=>null,preparePortalMount:e=>D(e.getState().scene,e,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:function(e){if(!e.isHidden){var t;e.props.attach&&null!=(t=e.parent)&&t.object?H(e.parent,e):Z(e.object)&&(e.object.visible=!1),e.isHidden=!0,Y(e)}},unhideInstance:ep,createTextInstance:eb,hideTextInstance:eb,unhideTextInstance:eb,scheduleTimeout:"function"==typeof setTimeout?setTimeout:void 0,cancelTimeout:"function"==typeof clearTimeout?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:u.createContext(null),setCurrentUpdatePriority(e){eM=e},getCurrentUpdatePriority:()=>eM,resolveUpdatePriority(){var e;if(0!==eM)return eM;switch("undefined"!=typeof window&&(null==(e=window.event)?void 0:e.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return d.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return d.ContinuousEventPriority;default:return d.DefaultEventPriority}},resetFormInstance(){}}),e_=new Map,eC={objects:"shallow",strict:!1};function eE(e){let t,r,n=e_.get(e),a=null==n?void 0:n.fiber,i=null==n?void 0:n.store;n&&console.warn("R3F.createRoot should only be called once!");let o="function"==typeof reportError?reportError:console.error,s=i||((e,t)=>{let r=g((r,n)=>{let a,i=new l.Pq0,o=new l.Pq0,s=new l.Pq0;function c(e=n().camera,t=o,r=n().size){let{width:a,height:l,top:u,left:f}=r,d=a/l;t.isVector3?s.copy(t):s.set(...t);let p=e.getWorldPosition(i).distanceTo(s);if(e&&e.isOrthographicCamera)return{width:a/e.zoom,height:l/e.zoom,top:u,left:f,factor:1,distance:p,aspect:d};{let t=2*Math.tan(e.fov*Math.PI/180/2)*p,r=a/l*t;return{width:r,height:t,top:u,left:f,factor:a/r,distance:p,aspect:d}}}let f=e=>r(t=>({performance:{...t.performance,current:e}})),d=new l.I9Y;return{set:r,get:n,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(t=1)=>e(n(),t),advance:(e,r)=>t(e,r,n()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new l.zD7,pointer:d,mouse:d,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{let e=n();a&&clearTimeout(a),e.performance.current!==e.performance.min&&f(e.performance.min),a=setTimeout(()=>f(n().performance.max),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:e=>r(t=>({...t,events:{...t.events,...e}})),setSize:(e,t,a=0,i=0)=>{let s=n().camera,l={width:e,height:t,top:a,left:i};r(e=>({size:l,viewport:{...e.viewport,...c(s,o,l)}}))},setDpr:e=>r(t=>{let r=O(e);return{viewport:{...t.viewport,dpr:r,initialDpr:t.viewport.initialDpr||r}}}),setFrameloop:(e="always")=>{let t=n().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),r(()=>({frameloop:e}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:u.createRef(),active:!1,frames:0,priority:0,subscribe:(e,t,r)=>{let a=n().internal;return a.priority=a.priority+ +(t>0),a.subscribers.push({ref:e,priority:t,store:r}),a.subscribers=a.subscribers.sort((e,t)=>e.priority-t.priority),()=>{let r=n().internal;null!=r&&r.subscribers&&(r.priority=r.priority-(t>0),r.subscribers=r.subscribers.filter(t=>t.ref!==e))}}}}}),n=r.getState(),a=n.size,i=n.viewport.dpr,o=n.camera;return r.subscribe(()=>{let{camera:e,size:t,viewport:n,gl:s,set:l}=r.getState();if(t.width!==a.width||t.height!==a.height||n.dpr!==i){a=t,i=n.dpr,X(e,t),n.dpr>0&&s.setPixelRatio(n.dpr);let r="undefined"!=typeof HTMLCanvasElement&&s.domElement instanceof HTMLCanvasElement;s.setSize(t.width,t.height,r)}e!==o&&(o=e,l(t=>({viewport:{...t.viewport,...t.viewport.getCurrentViewport(e)}})))}),r.subscribe(t=>e(t)),r})(eL,eN),f=a||eS.createContainer(s,d.ConcurrentRoot,null,!1,null,"",o,o,o,null);n||e_.set(e,{fiber:f,store:s});let p=!1,h=null;return{async configure(n={}){var a,i;let o;h=new Promise(e=>o=e);let{gl:u,size:f,scene:d,events:m,onCreated:v,shadows:g=!1,linear:w=!1,flat:y=!1,legacy:b=!1,orthographic:x=!1,frameloop:M="always",dpr:S=[1,2],performance:_,raycaster:C,camera:E,onPointerMissed:P}=n,R=s.getState(),k=R.gl;if(!R.gl){let t={canvas:e,powerPreference:"high-performance",antialias:!0,alpha:!0},r="function"==typeof u?await u(t):u;k=J(r)?r:new c.WebGLRenderer({...t,...u}),R.set({gl:k})}let j=R.raycaster;j||R.set({raycaster:j=new l.tBo});let{params:I,...T}=C||{};if(U.equ(T,j,eC)||V(j,{...T}),U.equ(I,j.params,eC)||V(j,{params:{...j.params,...I}}),!R.camera||R.camera===r&&!U.equ(r,E,eC)){r=E;let e=null==E?void 0:E.isCamera,t=e?E:x?new l.qUd(0,0,0,0,.1,1e3):new l.ubm(75,0,.1,1e3);!e&&(t.position.z=5,E&&(V(t,E),!t.manual&&("aspect"in E||"left"in E||"right"in E||"bottom"in E||"top"in E)&&(t.manual=!0,t.updateProjectionMatrix())),R.camera||null!=E&&E.rotation||t.lookAt(0,0,0)),R.set({camera:t}),j.camera=t}if(!R.scene){let e;null!=d&&d.isScene?D(e=d,s,"",{}):(D(e=new l.Z58,s,"",{}),d&&V(e,d)),R.set({scene:e})}m&&!R.events.handlers&&R.set({events:m(s)});let A=function(e,t){if(!t&&"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){let{width:t,height:r,top:n,left:a}=e.parentElement.getBoundingClientRect();return{width:t,height:r,top:n,left:a}}return!t&&"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0}:{width:0,height:0,top:0,left:0,...t}}(e,f);if(U.equ(A,R.size,eC)||R.setSize(A.width,A.height,A.top,A.left),S&&R.viewport.dpr!==O(S)&&R.setDpr(S),R.frameloop!==M&&R.setFrameloop(M),R.onPointerMissed||R.set({onPointerMissed:P}),_&&!U.equ(_,R.performance,eC)&&R.set(e=>({performance:{...e.performance,..._}})),!R.xr){let e=(e,t)=>{let r=s.getState();"never"!==r.frameloop&&eN(e,!0,r,t)},t=()=>{let t=s.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||eL(t)},r={connect(){let e=s.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){let e=s.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"==typeof(null==(a=k.xr)?void 0:a.addEventListener)&&r.connect(),R.set({xr:r})}if(k.shadowMap){let e=k.shadowMap.enabled,t=k.shadowMap.type;if(k.shadowMap.enabled=!!g,U.boo(g))k.shadowMap.type=l.Wk7;else if(U.str(g)){let e={basic:l.bTm,percentage:l.QP0,soft:l.Wk7,variance:l.RyA};k.shadowMap.type=null!=(i=e[g])?i:l.Wk7}else U.obj(g)&&Object.assign(k.shadowMap,g);(e!==k.shadowMap.enabled||t!==k.shadowMap.type)&&(k.shadowMap.needsUpdate=!0)}return l.ppV.enabled=!b,p||(k.outputColorSpace=w?l.Zr2:l.er$,k.toneMapping=y?l.y_p:l.FV),R.legacy!==b&&R.set(()=>({legacy:b})),R.linear!==w&&R.set(()=>({linear:w})),R.flat!==y&&R.set(()=>({flat:y})),!u||U.fun(u)||J(u)||U.equ(u,k,eC)||V(k,u),t=v,p=!0,o(),this},render(r){return p||h||this.configure(),h.then(()=>{eS.updateContainer((0,_.jsx)(eP,{store:s,children:r,onCreated:t,rootElement:e}),f,null,()=>void 0)}),s},unmount(){eR(e)}}}function eP({store:e,children:t,onCreated:r,rootElement:n}){return k(()=>{let t=e.getState();t.set(e=>({internal:{...e.internal,active:!0}})),r&&r(t),e.getState().events.connected||null==t.events.connect||t.events.connect(n)},[]),(0,_.jsx)(ee.Provider,{value:e,children:t})}function eR(e,t){let r=e_.get(e),n=null==r?void 0:r.fiber;if(n){let a=null==r?void 0:r.store.getState();a&&(a.internal.active=!1),eS.updateContainer(null,n,null,()=>{a&&setTimeout(()=>{try{null==a.events.disconnect||a.events.disconnect(),null==(r=a.gl)||null==(n=r.renderLists)||null==n.dispose||n.dispose(),null==(i=a.gl)||null==i.forceContextLoss||i.forceContextLoss(),null!=(o=a.gl)&&o.xr&&a.xr.disconnect();var r,n,i,o,s=a.scene;for(let e in"Scene"!==s.type&&(null==s.dispose||s.dispose()),s){let t=s[e];(null==t?void 0:t.type)!=="Scene"&&(null==t||null==t.dispose||t.dispose())}e_.delete(e),t&&t(e)}catch(e){}},500)})}}function ek(e,t,r){return(0,_.jsx)(ej,{children:e,container:t,state:r})}function ej({state:e={},children:t,container:r}){let{events:n,size:a,...i}=e,o=et(),[s]=u.useState(()=>new l.tBo),[c]=u.useState(()=>new l.I9Y),f=j((e,t)=>{let i;if(t.camera&&a){let r=t.camera;i=e.viewport.getCurrentViewport(r,new l.Pq0,a),r!==e.camera&&X(r,a)}return{...e,...t,scene:r,raycaster:s,pointer:c,mouse:c,previousRoot:o,events:{...e.events,...t.events,...n},size:{...e.size,...a},viewport:{...e.viewport,...i},setEvents:e=>t.set(t=>({...t,events:{...t.events,...e}}))}}),d=u.useMemo(()=>{let e=g((e,t)=>({...i,set:e,get:t})),t=t=>e.setState(e=>f.current(t,e));return t(o.getState()),o.subscribe(t),e},[o,r]);return(0,_.jsx)(_.Fragment,{children:eS.createPortal((0,_.jsx)(ee.Provider,{value:d,children:t}),d,null)})}let eI=new Set,eT=new Set,eA=new Set;function eO(e,t){if(e.size)for(let{callback:r}of e.values())r(t)}function eF(e,t){switch(e){case"before":return eO(eI,t);case"after":return eO(eT,t);case"tail":return eO(eA,t)}}function eU(e,t,r){let i=t.clock.getDelta();"never"===t.frameloop&&"number"==typeof e&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),n=t.internal.subscribers;for(let e=0;e<n.length;e++)(a=n[e]).ref.current(a.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}let ez=!1,eD=!1;function eB(e){for(let r of(o=requestAnimationFrame(eB),ez=!0,i=0,eF("before",e),eD=!0,e_.values())){var t;(s=r.store.getState()).internal.active&&("always"===s.frameloop||s.internal.frames>0)&&!(null!=(t=s.gl.xr)&&t.isPresenting)&&(i+=eU(e,s))}if(eD=!1,eF("after",e),0===i)return eF("tail",e),ez=!1,cancelAnimationFrame(o)}function eL(e,t=1){var r;if(!e)return e_.forEach(e=>eL(e.store.getState(),t));(null==(r=e.gl.xr)||!r.isPresenting)&&e.internal.active&&"never"!==e.frameloop&&(t>1?e.internal.frames=Math.min(60,e.internal.frames+t):eD?e.internal.frames=2:e.internal.frames=1,ez||(ez=!0,requestAnimationFrame(eB)))}function eN(e,t=!0,r,n){if(t&&eF("before",e),r)eU(e,r,n);else for(let t of e_.values())eU(e,t.store.getState());t&&eF("after",e)}let eH={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function eq(e){let{handlePointer:t}=function(e){function t(e){return e.filter(e=>["Move","Over","Enter","Out","Leave"].some(t=>{var r;return null==(r=e.__r3f)?void 0:r.handlers["onPointer"+t]}))}function r(t){let{internal:r}=e.getState();for(let e of r.hovered.values())if(!t.length||!t.find(t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId)){let n=e.eventObject.__r3f;if(r.hovered.delete(Q(e)),null!=n&&n.eventCount){let r=n.handlers,a={...e,intersections:t};null==r.onPointerOut||r.onPointerOut(a),null==r.onPointerLeave||r.onPointerLeave(a)}}}function n(e,t){for(let r=0;r<t.length;r++){let n=t[r].__r3f;null==n||null==n.handlers.onPointerMissed||n.handlers.onPointerMissed(e)}}return{handlePointer:function(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>r([]);case"onLostPointerCapture":return t=>{let{internal:n}=e.getState();"pointerId"in t&&n.capturedMap.has(t.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(t.pointerId)&&(n.capturedMap.delete(t.pointerId),r([]))})}}return function(i){let{onPointerMissed:o,internal:s}=e.getState();s.lastEvent.current=i;let c="onPointerMove"===a,u="onClick"===a||"onContextMenu"===a||"onDoubleClick"===a,f=function(t,r){let n=e.getState(),a=new Set,i=[],o=r?r(n.internal.interaction):n.internal.interaction;for(let e=0;e<o.length;e++){let t=F(o[e]);t&&(t.raycaster.camera=void 0)}n.previousRoot||null==n.events.compute||n.events.compute(t,n);let s=o.flatMap(function(e){let r=F(e);if(!r||!r.events.enabled||null===r.raycaster.camera)return[];if(void 0===r.raycaster.camera){var n;null==r.events.compute||r.events.compute(t,r,null==(n=r.previousRoot)?void 0:n.getState()),void 0===r.raycaster.camera&&(r.raycaster.camera=null)}return r.raycaster.camera?r.raycaster.intersectObject(e,!0):[]}).sort((e,t)=>{let r=F(e.object),n=F(t.object);return r&&n&&n.events.priority-r.events.priority||e.distance-t.distance}).filter(e=>{let t=Q(e);return!a.has(t)&&(a.add(t),!0)});for(let e of(n.events.filter&&(s=n.events.filter(s,n)),s)){let t=e.object;for(;t;){var l;null!=(l=t.__r3f)&&l.eventCount&&i.push({...e,eventObject:t}),t=t.parent}}if("pointerId"in t&&n.internal.capturedMap.has(t.pointerId))for(let e of n.internal.capturedMap.get(t.pointerId).values())a.has(Q(e.intersection))||i.push(e.intersection);return i}(i,c?t:void 0),d=u?function(t){let{internal:r}=e.getState(),n=t.offsetX-r.initialClick[0],a=t.offsetY-r.initialClick[1];return Math.round(Math.sqrt(n*n+a*a))}(i):0;"onPointerDown"===a&&(s.initialClick=[i.offsetX,i.offsetY],s.initialHits=f.map(e=>e.eventObject)),u&&!f.length&&d<=2&&(n(i,s.interaction),o&&o(i)),c&&r(f),!function(e,t,n,a){if(e.length){let i={stopped:!1};for(let o of e){let s=F(o.object);if(s||o.object.traverseAncestors(e=>{let t=F(e);if(t)return s=t,!1}),s){let{raycaster:c,pointer:u,camera:f,internal:d}=s,p=new l.Pq0(u.x,u.y,0).unproject(f),h=e=>{var t,r;return null!=(t=null==(r=d.capturedMap.get(e))?void 0:r.has(o.eventObject))&&t},m=e=>{let r={intersection:o,target:t.target};d.capturedMap.has(e)?d.capturedMap.get(e).set(o.eventObject,r):d.capturedMap.set(e,new Map([[o.eventObject,r]])),t.target.setPointerCapture(e)},v=e=>{let t=d.capturedMap.get(e);t&&K(d.capturedMap,o.eventObject,t,e)},g={};for(let e in t){let r=t[e];"function"!=typeof r&&(g[e]=r)}let w={...o,...g,pointer:u,intersections:e,stopped:i.stopped,delta:n,unprojectedPoint:p,ray:c.ray,camera:f,stopPropagation(){let n="pointerId"in t&&d.capturedMap.get(t.pointerId);(!n||n.has(o.eventObject))&&(w.stopped=i.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find(e=>e.eventObject===o.eventObject)&&r([...e.slice(0,e.indexOf(o)),o]))},target:{hasPointerCapture:h,setPointerCapture:m,releasePointerCapture:v},currentTarget:{hasPointerCapture:h,setPointerCapture:m,releasePointerCapture:v},nativeEvent:t};if(a(w),!0===i.stopped)break}}}}(f,i,d,function(e){let t=e.eventObject,r=t.__r3f;if(!(null!=r&&r.eventCount))return;let o=r.handlers;if(c){if(o.onPointerOver||o.onPointerEnter||o.onPointerOut||o.onPointerLeave){let t=Q(e),r=s.hovered.get(t);r?r.stopped&&e.stopPropagation():(s.hovered.set(t,e),null==o.onPointerOver||o.onPointerOver(e),null==o.onPointerEnter||o.onPointerEnter(e))}null==o.onPointerMove||o.onPointerMove(e)}else{let r=o[a];r?(!u||s.initialHits.includes(t))&&(n(i,s.interaction.filter(e=>!s.initialHits.includes(e))),r(e)):u&&s.initialHits.includes(t)&&n(i,s.interaction.filter(e=>!s.initialHits.includes(e)))}})}}}}(e);return{priority:1,enabled:!0,compute(e,t,r){t.pointer.set(e.offsetX/t.size.width*2-1,-(2*(e.offsetY/t.size.height))+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(eH).reduce((e,r)=>({...e,[r]:t(r)}),{}),update:()=>{var t;let{events:r,internal:n}=e.getState();null!=(t=n.lastEvent)&&t.current&&r.handlers&&r.handlers.onPointerMove(n.lastEvent.current)},connect:t=>{let{set:r,events:n}=e.getState();if(null==n.disconnect||n.disconnect(),r(e=>({events:{...e.events,connected:t}})),n.handlers)for(let e in n.handlers){let r=n.handlers[e],[a,i]=eH[e];t.addEventListener(a,r,{passive:i})}},disconnect:()=>{let{set:t,events:r}=e.getState();if(r.connected){if(r.handlers)for(let e in r.handlers){let t=r.handlers[e],[n]=eH[e];r.connected.removeEventListener(n,t)}t(e=>({events:{...e.events,connected:void 0}}))}}}}},2407:(e,t,r)=>{e.exports=r(6892)},2436:(e,t,r)=>{var n=r(2115),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=n.useState,o=n.useEffect,s=n.useLayoutEffect,l=n.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!a(e,r)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),n=i({inst:{value:r,getSnapshot:t}}),a=n[0].inst,u=n[1];return s(function(){a.value=r,a.getSnapshot=t,c(a)&&u({inst:a})},[e,r,t]),o(function(){return c(a)&&u({inst:a}),e(function(){c(a)&&u({inst:a})})},[e]),l(r),r};t.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:u},2834:(e,t,r)=>{r.d(t,{E8:()=>S,b1:()=>M,s0:()=>w,fE:()=>C});var n=r(5155),a=r(2115),i=r(3264),o=r(1949),s=r(1004);function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}new i.I9Y,new i.I9Y;function c(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var u=function e(t,r,n){var a=this;c(this,e),l(this,"dot2",function(e,t){return a.x*e+a.y*t}),l(this,"dot3",function(e,t,r){return a.x*e+a.y*t+a.z*r}),this.x=t,this.y=r,this.z=n},f=[new u(1,1,0),new u(-1,1,0),new u(1,-1,0),new u(-1,-1,0),new u(1,0,1),new u(-1,0,1),new u(1,0,-1),new u(-1,0,-1),new u(0,1,1),new u(0,-1,1),new u(0,1,-1),new u(0,-1,-1)],d=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],p=Array(512),h=Array(512);!function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t,r=0;r<256;r++)t=1&r?d[r]^255&e:d[r]^e>>8&255,p[r]=p[r+256]=t,h[r]=h[r+256]=f[t%12]}(0);function m(e){var t=function(e){if("number"==typeof e)e=Math.abs(e);else if("string"==typeof e){var t=e;e=0;for(var r=0;r<t.length;r++)e=(e+(r+1)*(t.charCodeAt(r)%96))%0x7fffffff}return 0===e&&(e=311),e}(e);return function(){var e=48271*t%0x7fffffff;return t=e,e/0x7fffffff}}new function e(t){var r=this;c(this,e),l(this,"seed",0),l(this,"init",function(e){r.seed=e,r.value=m(e)}),l(this,"value",m(this.seed)),this.init(t)}(Math.random());i.LoY;r(4687);let v=(0,a.createContext)(null),g=e=>(2&e.getAttributes())==2,w=(0,a.memo)((0,a.forwardRef)(({children:e,camera:t,scene:r,resolutionScale:l,enabled:c=!0,renderPriority:u=1,autoClear:f=!0,depthBuffer:d,enableNormalPass:p,stencilBuffer:h,multisampling:m=8,frameBufferType:w=i.ix0},y)=>{let{gl:b,scene:x,camera:M,size:S}=(0,o.C)(),_=r||x,C=t||M,[E,P,R]=(0,a.useMemo)(()=>{let e=new s.s0(b,{depthBuffer:d,stencilBuffer:h,multisampling:m,frameBufferType:w});e.addPass(new s.AH(_,C));let t=null,r=null;return p&&((r=new s.Xe(_,C)).enabled=!1,e.addPass(r),void 0!==l&&((t=new s.SP({normalBuffer:r.texture,resolutionScale:l})).enabled=!1,e.addPass(t))),[e,r,t]},[C,b,d,h,m,w,_,p,l]);(0,a.useEffect)(()=>E?.setSize(S.width,S.height),[E,S]),(0,o.D)((e,t)=>{if(c){let e=b.autoClear;b.autoClear=f,h&&!f&&b.clearStencil(),E.render(t),b.autoClear=e}},c?u:0);let k=(0,a.useRef)(null);(0,a.useLayoutEffect)(()=>{let e=[],t=k.current.__r3f;if(t&&E){let r=t.children;for(let t=0;t<r.length;t++){let n=r[t].object;if(n instanceof s.Mj){let a=[n];if(!g(n)){let e=null;for(;(e=r[t+1]?.object)instanceof s.Mj&&!g(e);)a.push(e),t++}let i=new s.Vu(C,...a);e.push(i)}else n instanceof s.oF&&e.push(n)}for(let t of e)E?.addPass(t);P&&(P.enabled=!0),R&&(R.enabled=!0)}return()=>{for(let t of e)E?.removePass(t);P&&(P.enabled=!1),R&&(R.enabled=!1)}},[E,e,C,P,R]),(0,a.useEffect)(()=>{let e=b.toneMapping;return b.toneMapping=i.y_p,()=>{b.toneMapping=e}},[b]);let j=(0,a.useMemo)(()=>({composer:E,normalPass:P,downSamplingPass:R,resolutionScale:l,camera:C,scene:_}),[E,P,R,l,C,_]);return(0,a.useImperativeHandle)(y,()=>E,[E]),(0,n.jsx)(v.Provider,{value:j,children:(0,n.jsx)("group",{ref:k,children:e})})})),y=0,b=new WeakMap,x=(e,t)=>function({blendFunction:r=t?.blendFunction,opacity:i=t?.opacity,...s}){let l=b.get(e);if(!l){let t=`@react-three/postprocessing/${e.name}-${y++}`;(0,o.e)({[t]:e}),b.set(e,l=t)}let c=(0,o.C)(e=>e.camera),u=a.useMemo(()=>[...t?.args??[],...s.args??[{...t,...s}]],[JSON.stringify(s)]);return(0,n.jsx)(l,{camera:c,"blendMode-blendFunction":r,"blendMode-opacity-value":i,...s,args:u})},M=(0,a.forwardRef)(function({blendFunction:e,worldFocusDistance:t,worldFocusRange:r,focusDistance:o,focusRange:l,focalLength:c,bokehScale:u,resolutionScale:f,resolutionX:d,resolutionY:p,width:h,height:m,target:g,depthTexture:w,...y},b){let{camera:x}=(0,a.useContext)(v),M=null!=g,S=(0,a.useMemo)(()=>{let n=new s.kt(x,{blendFunction:e,worldFocusDistance:t,worldFocusRange:r,focusDistance:o,focusRange:l,focalLength:c,bokehScale:u,resolutionScale:f,resolutionX:d,resolutionY:p,width:h,height:m});return M&&(n.target=new i.Pq0),w&&n.setDepthTexture(w.texture,w.packing),n.maskPass.maskFunction=s.qM.MULTIPLY_RGB_SET_ALPHA,n},[x,e,t,r,o,l,c,u,f,d,p,h,m,M,w]);return(0,a.useEffect)(()=>()=>{S.dispose()},[S]),(0,n.jsx)("primitive",{...y,ref:b,object:S,target:g})});s.Mj,s.bv;let S=x(s.t$);s.i,s.hH;var _=(e=>(e[e.Linear=0]="Linear",e[e.Radial=1]="Radial",e[e.MirroredLinear=2]="MirroredLinear",e))(_||{});s.Mj;let C=x(s.K1),E=(s.To,{fragmentShader:`

    // original shader by Evan Wallace

    #define MAX_ITERATIONS 100

    uniform float blur;
    uniform float taper;
    uniform vec2 start;
    uniform vec2 end;
    uniform vec2 direction;
    uniform int samples;

    float random(vec3 scale, float seed) {
        /* use the fragment position for a different seed per-pixel */
        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
    }

    void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
        vec4 color = vec4(0.0);
        float total = 0.0;
        vec2 startPixel = vec2(start.x * resolution.x, start.y * resolution.y);
        vec2 endPixel = vec2(end.x * resolution.x, end.y * resolution.y);
        float f_samples = float(samples);
        float half_samples = f_samples / 2.0;

        // use screen diagonal to normalize blur radii
        float maxScreenDistance = distance(vec2(0.0), resolution); // diagonal distance
        float gradientRadius = taper * (maxScreenDistance);
        float blurRadius = blur * (maxScreenDistance / 16.0);

        /* randomize the lookup values to hide the fixed number of samples */
        float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
        vec2 normal = normalize(vec2(startPixel.y - endPixel.y, endPixel.x - startPixel.x));
        float radius = smoothstep(0.0, 1.0, abs(dot(uv * resolution - startPixel, normal)) / gradientRadius) * blurRadius;

        #pragma unroll_loop_start
        for (int i = 0; i <= MAX_ITERATIONS; i++) {
            if (i >= samples) { break; } // return early if over sample count
            float f_i = float(i);
            float s_i = -half_samples + f_i;
            float percent = (s_i + offset - 0.5) / half_samples;
            float weight = 1.0 - abs(percent);
            vec4 sample_i = texture2D(inputBuffer, uv + normalize(direction) / resolution * percent * radius);
            /* switch to pre-multiplied alpha to correctly blur transparent images */
            sample_i.rgb *= sample_i.a;
            color += sample_i * weight;
            total += weight;
        }
        #pragma unroll_loop_end

        outputColor = color / total;

        /* switch back from pre-multiplied alpha */
        outputColor.rgb /= outputColor.a + 0.00001;
    }
    `});s.Mj;s.Mj;s.Mj},5220:(e,t,r)=>{e.exports=r(1724)},5643:(e,t,r)=>{e.exports=r(6115)},6115:(e,t,r)=>{var n=r(2115),a=r(9033),i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=a.useSyncExternalStore,s=n.useRef,l=n.useEffect,c=n.useMemo,u=n.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,n,a){var f=s(null);if(null===f.current){var d={hasValue:!1,value:null};f.current=d}else d=f.current;var p=o(e,(f=c(function(){function e(e){if(!l){if(l=!0,o=e,e=n(e),void 0!==a&&d.hasValue){var t=d.value;if(a(t,e))return s=t}return s=e}if(t=s,i(o,e))return t;var r=n(e);return void 0!==a&&a(t,r)?(o=e,t):(o=e,s=r)}var o,s,l=!1,c=void 0===r?null:r;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,r,n,a]))[0],f[1]);return l(function(){d.hasValue=!0,d.value=p},[p]),u(p),p}},6354:(e,t,r)=>{r.d(t,{Af:()=>s,Nz:()=>a,u5:()=>l,y3:()=>f});var n=r(2115);function a(e,t,r){if(!e)return;if(!0===r(e))return e;let n=t?e.return:e.child;for(;n;){let e=a(n,t,r);if(e)return e;n=t?null:n.sibling}}function i(e){try{return Object.defineProperties(e,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(t){return e}}(()=>{var e,t;return"undefined"!=typeof window&&((null==(e=window.document)?void 0:e.createElement)||(null==(t=window.navigator)?void 0:t.product)==="ReactNative")})()?n.useLayoutEffect:n.useEffect;let o=i(n.createContext(null));class s extends n.Component{render(){return n.createElement(o.Provider,{value:this._reactInternals},this.props.children)}}function l(){let e=n.useContext(o);if(null===e)throw Error("its-fine: useFiber must be called within a <FiberProvider />!");let t=n.useId();return n.useMemo(()=>{for(let r of[e,null==e?void 0:e.alternate]){if(!r)continue;let e=a(r,!1,e=>{let r=e.memoizedState;for(;r;){if(r.memoizedState===t)return!0;r=r.next}});if(e)return e}},[e,t])}let c=Symbol.for("react.context"),u=e=>null!==e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===c;function f(){let e=function(){let e=l(),[t]=n.useState(()=>new Map);t.clear();let r=e;for(;r;){let e=r.type;u(e)&&e!==o&&!t.has(e)&&t.set(e,n.use(i(e))),r=r.return}return t}();return n.useMemo(()=>Array.from(e.keys()).reduce((t,r)=>a=>n.createElement(t,null,n.createElement(r.Provider,{...a,value:e.get(r)})),e=>n.createElement(s,{...e})),[e])}},6500:(e,t)=>{t.ConcurrentRoot=1,t.ContinuousEventPriority=8,t.DefaultEventPriority=32,t.DiscreteEventPriority=2},6850:(e,t,r)=>{r.d(t,{w:()=>s});var n=r(2115),a=r(7431),i=r(1949);function o(e,t,r){t.traverse(t=>{t.material&&(e.properties.remove(t.material),null==t.material.dispose||t.material.dispose())}),e.info.programs.length=0,e.compile(t,r)}function s({focus:e=0,samples:t=10,size:r=25}){let s=(0,i.C)(e=>e.gl),l=(0,i.C)(e=>e.scene),c=(0,i.C)(e=>e.camera);return n.useEffect(()=>{let n=a.ShaderChunk.shadowmap_pars_fragment;return a.ShaderChunk.shadowmap_pars_fragment=a.ShaderChunk.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP","#ifdef USE_SHADOWMAP\n"+(({focus:e=0,size:t=25,samples:r=10}={})=>`
#define PENUMBRA_FILTER_SIZE float(${t})
#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))
vec3 randRGB(vec2 uv) {
  return vec3(
    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),
    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),
    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)
  );
}

vec3 lowPassRandRGB(vec2 uv) {
  // 3x3 convolution (average)
  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9
  vec3 result = vec3(0);
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));
  result *= 0.111111111; // 1.0 / 9.0
  return result;
}
vec3 highPassRandRGB(vec2 uv) {
  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal
  // hp(x) = x - lp(x)
  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;
}


vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}
float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation
  return (zReceiver - zBlocker) / zBlocker;
}
float findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float blockerDepthSum = float(${e});
  float blockers = 0.0;

  int j = 0;
  vec2 offset = vec2(0.);
  float depth = 0.;

  #pragma unroll_loop_start
  for(int i = 0; i < ${r}; i ++) {
    offset = (vogelDiskSample(j, ${r}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;
    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));
    if (depth < compare) {
      blockerDepthSum += depth;
      blockers++;
    }
    j++;
  }
  #pragma unroll_loop_end

  if (blockers > 0.0) {
    return blockerDepthSum / blockers;
  }
  return -1.0;
}

        
float vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float shadow = 0.0f;
  int j = 0;
  vec2 vogelSample = vec2(0.0);
  vec2 offset = vec2(0.0);
  #pragma unroll_loop_start
  for (int i = 0; i < ${r}; i++) {
    vogelSample = vogelDiskSample(j, ${r}, angle) * texelSize;
    offset = vogelSample * (1.0 + filterRadius * float(${t}));
    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    j++;
  }
  #pragma unroll_loop_end
  return shadow * 1.0 / ${r}.0;
}

float PCSS (sampler2D shadowMap, vec4 coords) {
  vec2 uv = coords.xy;
  float zReceiver = coords.z; // Assumed to be eye-space z in this code
  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;
  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);
  if (avgBlockerDepth == -1.0) {
    return 1.0;
  }
  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);
  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);
}`)({size:r,samples:t,focus:e})).replace("#if defined( SHADOWMAP_TYPE_PCF )","\nreturn PCSS(shadowMap, shadowCoord);\n#if defined( SHADOWMAP_TYPE_PCF )"),o(s,l,c),()=>{a.ShaderChunk.shadowmap_pars_fragment=n,o(s,l,c)}},[e,r,t]),null}},6892:(e,t)=>{function r(e,t){var r=e.length;for(e.push(t);0<r;){var n=r-1>>>1,a=e[n];if(0<i(a,t))e[n]=t,e[r]=a,r=n;else break}}function n(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;for(var n=0,a=e.length,o=a>>>1;n<o;){var s=2*(n+1)-1,l=e[s],c=s+1,u=e[c];if(0>i(l,r))c<a&&0>i(u,l)?(e[n]=u,e[c]=r,n=c):(e[n]=l,e[s]=r,n=s);else if(c<a&&0>i(u,r))e[n]=u,e[c]=r,n=c;else break}}return t}function i(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}if(t.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var o,s=performance;t.unstable_now=function(){return s.now()}}else{var l=Date,c=l.now();t.unstable_now=function(){return l.now()-c}}var u=[],f=[],d=1,p=null,h=3,m=!1,v=!1,g=!1,w="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var t=n(f);null!==t;){if(null===t.callback)a(f);else if(t.startTime<=e)a(f),t.sortIndex=t.expirationTime,r(u,t);else break;t=n(f)}}function M(e){if(g=!1,x(e),!v)if(null!==n(u))v=!0,I();else{var t=n(f);null!==t&&T(M,t.startTime-e)}}var S=!1,_=-1,C=5,E=-1;function P(){return!(t.unstable_now()-E<C)}function R(){if(S){var e=t.unstable_now();E=e;var r=!0;try{e:{v=!1,g&&(g=!1,y(_),_=-1),m=!0;var i=h;try{t:{for(x(e),p=n(u);null!==p&&!(p.expirationTime>e&&P());){var s=p.callback;if("function"==typeof s){p.callback=null,h=p.priorityLevel;var l=s(p.expirationTime<=e);if(e=t.unstable_now(),"function"==typeof l){p.callback=l,x(e),r=!0;break t}p===n(u)&&a(u),x(e)}else a(u);p=n(u)}if(null!==p)r=!0;else{var c=n(f);null!==c&&T(M,c.startTime-e),r=!1}}break e}finally{p=null,h=i,m=!1}}}finally{r?o():S=!1}}}if("function"==typeof b)o=function(){b(R)};else if("undefined"!=typeof MessageChannel){var k=new MessageChannel,j=k.port2;k.port1.onmessage=R,o=function(){j.postMessage(null)}}else o=function(){w(R,0)};function I(){S||(S=!0,o())}function T(e,r){_=w(function(){e(t.unstable_now())},r)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||m||(v=!0,I())},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var r=h;h=t;try{return e()}finally{h=r}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=h;h=e;try{return t()}finally{h=r}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch(i="object"==typeof i&&null!==i&&"number"==typeof(i=i.delay)&&0<i?o+i:o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=0x3fffffff;break;case 4:s=1e4;break;default:s=5e3}return s=i+s,e={id:d++,callback:a,priorityLevel:e,startTime:i,expirationTime:s,sortIndex:-1},i>o?(e.sortIndex=i,r(f,e),null===n(u)&&e===n(f)&&(g?(y(_),_=-1):g=!0,T(M,i-o))):(e.sortIndex=s,r(u,e),v||m||(v=!0,I())),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=h;return function(){var r=h;h=t;try{return e.apply(this,arguments)}finally{h=r}}}},7558:(e,t,r)=>{r.d(t,{Hl:()=>f});var n=r(1949),a=r(2115),i=r(7431);function o(e,t){let r;return(...n)=>{window.clearTimeout(r),r=window.setTimeout(()=>e(...n),t)}}let s=["x","y","top","bottom","left","right","width","height"];var l=r(6354),c=r(5155);function u({ref:e,children:t,fallback:r,resize:l,style:u,gl:f,events:d=n.f,eventSource:p,eventPrefix:h,shadows:m,linear:v,flat:g,legacy:w,orthographic:y,frameloop:b,dpr:x,performance:M,raycaster:S,camera:_,scene:C,onPointerMissed:E,onCreated:P,...R}){a.useMemo(()=>(0,n.e)(i),[]);let k=(0,n.u)(),[j,I]=function({debounce:e,scroll:t,polyfill:r,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){var i,l,c;let u=r||("undefined"==typeof window?class{}:window.ResizeObserver);if(!u)throw Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");let[f,d]=(0,a.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),p=(0,a.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:f,orientationHandler:null}),h=e?"number"==typeof e?e:e.scroll:null,m=e?"number"==typeof e?e:e.resize:null,v=(0,a.useRef)(!1);(0,a.useEffect)(()=>(v.current=!0,()=>void(v.current=!1)));let[g,w,y]=(0,a.useMemo)(()=>{let e=()=>{let e,t;if(!p.current.element)return;let{left:r,top:a,width:i,height:o,bottom:l,right:c,x:u,y:f}=p.current.element.getBoundingClientRect(),h={left:r,top:a,width:i,height:o,bottom:l,right:c,x:u,y:f};p.current.element instanceof HTMLElement&&n&&(h.height=p.current.element.offsetHeight,h.width=p.current.element.offsetWidth),Object.freeze(h),v.current&&(e=p.current.lastBounds,t=h,!s.every(r=>e[r]===t[r]))&&d(p.current.lastBounds=h)};return[e,m?o(e,m):e,h?o(e,h):e]},[d,n,h,m]);function b(){p.current.scrollContainers&&(p.current.scrollContainers.forEach(e=>e.removeEventListener("scroll",y,!0)),p.current.scrollContainers=null),p.current.resizeObserver&&(p.current.resizeObserver.disconnect(),p.current.resizeObserver=null),p.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",p.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",p.current.orientationHandler))}function x(){p.current.element&&(p.current.resizeObserver=new u(y),p.current.resizeObserver.observe(p.current.element),t&&p.current.scrollContainers&&p.current.scrollContainers.forEach(e=>e.addEventListener("scroll",y,{capture:!0,passive:!0})),p.current.orientationHandler=()=>{y()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",p.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",p.current.orientationHandler))}return i=y,l=!!t,(0,a.useEffect)(()=>{if(l)return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)},[i,l]),c=w,(0,a.useEffect)(()=>(window.addEventListener("resize",c),()=>void window.removeEventListener("resize",c)),[c]),(0,a.useEffect)(()=>{b(),x()},[t,y,w]),(0,a.useEffect)(()=>b,[]),[e=>{e&&e!==p.current.element&&(b(),p.current.element=e,p.current.scrollContainers=function e(t){let r=[];if(!t||t===document.body)return r;let{overflow:n,overflowX:a,overflowY:i}=window.getComputedStyle(t);return[n,a,i].some(e=>"auto"===e||"scroll"===e)&&r.push(t),[...r,...e(t.parentElement)]}(e),x())},f,g]}({scroll:!0,debounce:{scroll:50,resize:0},...l}),T=a.useRef(null),A=a.useRef(null);a.useImperativeHandle(e,()=>T.current);let O=(0,n.a)(E),[F,U]=a.useState(!1),[z,D]=a.useState(!1);if(F)throw F;if(z)throw z;let B=a.useRef(null);(0,n.b)(()=>{let e=T.current;I.width>0&&I.height>0&&e&&(B.current||(B.current=(0,n.c)(e)),async function(){await B.current.configure({gl:f,scene:C,events:d,shadows:m,linear:v,flat:g,legacy:w,orthographic:y,frameloop:b,dpr:x,performance:M,raycaster:S,camera:_,size:I,onPointerMissed:(...e)=>null==O.current?void 0:O.current(...e),onCreated:e=>{null==e.events.connect||e.events.connect(p?(0,n.i)(p)?p.current:p:A.current),h&&e.setEvents({compute:(e,t)=>{let r=e[h+"X"],n=e[h+"Y"];t.pointer.set(r/t.size.width*2-1,-(2*(n/t.size.height))+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==P||P(e)}}),B.current.render((0,c.jsx)(k,{children:(0,c.jsx)(n.E,{set:D,children:(0,c.jsx)(a.Suspense,{fallback:(0,c.jsx)(n.B,{set:U}),children:null!=t?t:null})})}))}())}),a.useEffect(()=>{let e=T.current;if(e)return()=>(0,n.d)(e)},[]);let L=p?"none":"auto";return(0,c.jsx)("div",{ref:A,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:L,...u},...R,children:(0,c.jsx)("div",{ref:j,style:{width:"100%",height:"100%"},children:(0,c.jsx)("canvas",{ref:T,style:{display:"block"},children:r})})})}function f(e){return(0,c.jsx)(l.Af,{children:(0,c.jsx)(u,{...e})})}r(1933),r(5220),r(2407)},8358:(e,t,r)=>{r.d(t,{o:()=>a});var n=r(3264);class a{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}new n.qUd(-1,1,1,-1,0,1);class i extends n.LoY{constructor(){super(),this.setAttribute("position",new n.qtW([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new n.qtW([0,2,0,0,2,0],2))}}new i},8751:(e,t,r)=>{let n;r.d(t,{OH:()=>ew});var a=r(9630),i=r(2115),o=r(1949),s=r(3264);let l=parseInt(s.sPf.replace(/\D+/g,""));class c extends s.eaF{constructor(e,t){var r,n;let a=(e=>e&&e.isCubeTexture)(e),i=Math.floor(Math.log2((null!=(n=a?null==(r=e.image[0])?void 0:r.width:e.image.width)?n:1024)/4)),o=Math.pow(2,i),c=3*Math.max(o,112),u=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,f=[a?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/c}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*o)}`,`#define CUBEUV_MAX_MIP ${i}.0`].join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${l>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,d={map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}};super(new s.WBB(1,16),new s.BKk({uniforms:d,fragmentShader:f,vertexShader:u,side:s.$EB}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}class u extends s.BRH{constructor(e){super(e),this.type=s.ix0}parse(e){let t,r,n,a=function(e,t){switch(e){case 1:throw Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(t||""))}},i=function(e,t,r){t=t||1024;let n=e.pos,a=-1,i=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(a=s.indexOf("\n"))&&i<t&&n<e.byteLength;)o+=s,i+=s.length,n+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return -1<a&&(!1!==r&&(e.pos+=i+a+1),o+s.slice(0,a))},o=new Uint8Array(e);o.pos=0;let l=function(e){let t,r,n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(e.pos>=e.byteLength)&&(t=i(e))||a(1,"no header found"),(r=t.match(/^#\?(\S+)/))||a(3,"bad initial token"),c.valid|=1,c.programtype=r[1],c.string+=t+"\n";!1!==(t=i(e));){if(c.string+=t+"\n","#"===t.charAt(0)){c.comments+=t+"\n";continue}if((r=t.match(n))&&(c.gamma=parseFloat(r[1])),(r=t.match(o))&&(c.exposure=parseFloat(r[1])),(r=t.match(s))&&(c.valid|=2,c.format=r[1]),(r=t.match(l))&&(c.valid|=4,c.height=parseInt(r[1],10),c.width=parseInt(r[2],10)),2&c.valid&&4&c.valid)break}return 2&c.valid||a(3,"missing format specifier"),4&c.valid||a(3,"missing image size specifier"),c}(o),c=l.width,u=l.height,f=function(e,t,r){if(t<8||t>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);t!==(e[2]<<8|e[3])&&a(3,"wrong scanline width");let n=new Uint8Array(4*t*r);n.length||a(4,"unable to allocate buffer space");let i=0,o=0,s=4*t,l=new Uint8Array(4),c=new Uint8Array(s),u=r;for(;u>0&&o<e.byteLength;){o+4>e.byteLength&&a(1),l[0]=e[o++],l[1]=e[o++],l[2]=e[o++],l[3]=e[o++],(2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=t)&&a(3,"bad rgbe scanline format");let r=0,f;for(;r<s&&o<e.byteLength;){let t=(f=e[o++])>128;if(t&&(f-=128),(0===f||r+f>s)&&a(3,"bad scanline data"),t){let t=e[o++];for(let e=0;e<f;e++)c[r++]=t}else c.set(e.subarray(o,o+f),r),r+=f,o+=f}for(let e=0;e<t;e++){let r=0;n[i]=c[e+r],r+=t,n[i+1]=c[e+r],r+=t,n[i+2]=c[e+r],r+=t,n[i+3]=c[e+r],i+=4}u--}return n}(o.subarray(o.pos),c,u);switch(this.type){case s.RQf:let d=new Float32Array(4*(n=f.length/4));for(let e=0;e<n;e++)!function(e,t,r,n){let a=Math.pow(2,e[t+3]-128)/255;r[n+0]=e[t+0]*a,r[n+1]=e[t+1]*a,r[n+2]=e[t+2]*a,r[n+3]=1}(f,4*e,d,4*e);t=d,r=s.RQf;break;case s.ix0:let p=new Uint16Array(4*(n=f.length/4));for(let e=0;e<n;e++)!function(e,t,r,n){let a=Math.pow(2,e[t+3]-128)/255;r[n+0]=s.GxU.toHalfFloat(Math.min(e[t+0]*a,65504)),r[n+1]=s.GxU.toHalfFloat(Math.min(e[t+1]*a,65504)),r[n+2]=s.GxU.toHalfFloat(Math.min(e[t+2]*a,65504)),r[n+3]=s.GxU.toHalfFloat(1)}(f,4*e,p,4*e);t=p,r=s.ix0;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:c,height:u,data:t,header:l.string,gamma:l.gamma,exposure:l.exposure,type:r}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,function(e,r){switch(e.type){case s.RQf:case s.ix0:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=s.k6q,e.magFilter=s.k6q,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,n)}}var f=Uint8Array,d=Uint16Array,p=Uint32Array,h=new f([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),m=new f([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),v=new f([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=function(e,t){for(var r=new d(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var a=new p(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)a[i]=i-r[n]<<5|n;return[r,a]},w=g(h,2),y=w[0],b=w[1];y[28]=258,b[258]=28;var x=g(m,0),M=x[0];x[1];for(var S=new d(32768),_=0;_<32768;++_){var C=(43690&_)>>>1|(21845&_)<<1;C=(61680&(C=(52428&C)>>>2|(13107&C)<<2))>>>4|(3855&C)<<4,S[_]=((65280&C)>>>8|(255&C)<<8)>>>1}for(var E=function(e,t,r){for(var n,a=e.length,i=0,o=new d(t);i<a;++i)++o[e[i]-1];var s=new d(t);for(i=0;i<t;++i)s[i]=s[i-1]+o[i-1]<<1;if(r){n=new d(1<<t);var l=15-t;for(i=0;i<a;++i)if(e[i])for(var c=i<<4|e[i],u=t-e[i],f=s[e[i]-1]++<<u,p=f|(1<<u)-1;f<=p;++f)n[S[f]>>>l]=c}else for(i=0,n=new d(a);i<a;++i)e[i]&&(n[i]=S[s[e[i]-1]++]>>>15-e[i]);return n},P=new f(288),_=0;_<144;++_)P[_]=8;for(var _=144;_<256;++_)P[_]=9;for(var _=256;_<280;++_)P[_]=7;for(var _=280;_<288;++_)P[_]=8;for(var R=new f(32),_=0;_<32;++_)R[_]=5;var k=E(P,9,1),j=E(R,5,1),I=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},T=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},A=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},O=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof d?d:e instanceof p?p:f)(r-t);return n.set(e.subarray(t,r)),n},F=function(e,t,r){var n=e.length;if(!n||r&&!r.l&&n<5)return t||new f(0);var a=!t||r,i=!r||r.i;r||(r={}),t||(t=new f(3*n));var o=function(e){var r=t.length;if(e>r){var n=new f(Math.max(2*r,e));n.set(t),t=n}},s=r.f||0,l=r.p||0,c=r.b||0,u=r.l,d=r.d,p=r.m,g=r.n,w=8*n;do{if(!u){r.f=s=T(e,l,1);var b=T(e,l+1,3);if(l+=3,b)if(1==b)u=k,d=j,p=9,g=5;else if(2==b){var x=T(e,l,31)+257,S=T(e,l+10,15)+4,_=x+T(e,l+5,31)+1;l+=14;for(var C=new f(_),P=new f(19),R=0;R<S;++R)P[v[R]]=T(e,l+3*R,7);l+=3*S;for(var F=I(P),U=(1<<F)-1,z=E(P,F,1),R=0;R<_;){var D=z[T(e,l,U)];l+=15&D;var B=D>>>4;if(B<16)C[R++]=B;else{var L=0,N=0;for(16==B?(N=3+T(e,l,3),l+=2,L=C[R-1]):17==B?(N=3+T(e,l,7),l+=3):18==B&&(N=11+T(e,l,127),l+=7);N--;)C[R++]=L}}var H=C.subarray(0,x),q=C.subarray(x);p=I(H),g=I(q),u=E(H,p,1),d=E(q,g,1)}else throw"invalid block type";else{var G,B=((G=l)/8|0)+(7&G&&1)+4,W=e[B-4]|e[B-3]<<8,$=B+W;if($>n){if(i)throw"unexpected EOF";break}a&&o(c+W),t.set(e.subarray(B,$),c),r.b=c+=W,r.p=l=8*$;continue}if(l>w){if(i)throw"unexpected EOF";break}}a&&o(c+131072);for(var V=(1<<p)-1,Y=(1<<g)-1,X=l;;X=l){var L=u[A(e,l)&V],Z=L>>>4;if((l+=15&L)>w){if(i)throw"unexpected EOF";break}if(!L)throw"invalid length/literal";if(Z<256)t[c++]=Z;else if(256==Z){X=l,u=null;break}else{var Q=Z-254;if(Z>264){var R=Z-257,K=h[R];Q=T(e,l,(1<<K)-1)+y[R],l+=K}var J=d[A(e,l)&Y],ee=J>>>4;if(!J)throw"invalid distance";l+=15&J;var q=M[ee];if(ee>3){var K=m[ee];q+=A(e,l)&(1<<K)-1,l+=K}if(l>w){if(i)throw"unexpected EOF";break}a&&o(c+131072);for(var et=c+Q;c<et;c+=4)t[c]=t[c-q],t[c+1]=t[c+1-q],t[c+2]=t[c+2-q],t[c+3]=t[c+3-q];c=et}}r.l=u,r.p=X,r.b=c,u&&(s=1,r.m=p,r.d=d,r.n=g)}while(!s);return c==t.length?t:O(t,0,c)},U=new f(0),z=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function D(e,t){return F((z(e),e.subarray(2,-4)),t)}var B="undefined"!=typeof TextDecoder&&new TextDecoder;try{B.decode(U,{stream:!0})}catch(e){}let L=l>=152;class N extends s.BRH{constructor(e){super(e),this.type=s.ix0}parse(e){let t={l:0,c:0,lc:0};function r(e,r,n,a,i){for(;n<e;)r=r<<8|E(a,i),n+=8;t.l=r>>(n-=e)&(1<<e)-1,t.c=r,t.lc=n}let n=Array(59),a={c:0,lc:0};function i(e,t,r,n){e=e<<8|E(r,n),t+=8,a.c=e,a.lc=t}let o={c:0,lc:0};function l(e,t,r,n,s,l,c,u,f,d){if(e==t){n<8&&(i(r,n,s,c),r=a.c,n=a.lc);var p=r>>(n-=8),p=new Uint8Array([p])[0];if(f.value+p>d)return!1;for(var h=u[f.value-1];p-- >0;)u[f.value++]=h}else{if(!(f.value<d))return!1;u[f.value++]=e}o.c=r,o.lc=n}function c(e){var t=65535&e;return t>32767?t-65536:t}let u={a:0,b:0};function f(e,t){var r=c(e),n=c(t),a=r+(1&n)+(n>>1),i=a-n;u.a=a,u.b=i}function d(e,t){var r=65535&t,n=(65535&e)-(r>>1)&65535;u.a=r+n-32768&65535,u.b=n}function p(e,s,c,u,f,d){var p=c.value,h=C(s,c),m=C(s,c);c.value+=4;var v=C(s,c);if(c.value+=4,h<0||h>=65537||m<0||m>=65537)throw"Something wrong with HUF_ENCSIZE";for(var g=Array(65537),w=Array(16384),y=0;y<16384;y++)w[y]={},w[y].len=0,w[y].lit=0,w[y].p=null;var b=u-(c.value-p);if(!function(e,a,i,o,s,l,c){for(var u=0,f=0;s<=l;s++){if(i.value-i.value>o)return!1;r(6,u,f,e,i);var d=t.l;if(u=t.c,f=t.lc,c[s]=d,63==d){if(i.value-i.value>o)throw"Something wrong with hufUnpackEncTable";r(8,u,f,e,i);var p=t.l+6;if(u=t.c,f=t.lc,s+p>l+1)throw"Something wrong with hufUnpackEncTable";for(;p--;)c[s++]=0;s--}else if(d>=59){var p=d-59+2;if(s+p>l+1)throw"Something wrong with hufUnpackEncTable";for(;p--;)c[s++]=0;s--}}!function(e){for(var t=0;t<=58;++t)n[t]=0;for(var t=0;t<65537;++t)n[e[t]]+=1;for(var r=0,t=58;t>0;--t){var a=r+n[t]>>1;n[t]=r,r=a}for(var t=0;t<65537;++t){var i=e[t];i>0&&(e[t]=i|n[i]++<<6)}}(c)}(e,0,c,b,h,m,g),v>8*(u-(c.value-p)))throw"Something wrong with hufUncompress";!function(e,t,r,n){for(;t<=r;t++){var a=e[t]>>6,i=63&e[t];if(a>>i)throw"Invalid table entry";if(i>14){var o=n[a>>i-14];if(o.len)throw"Invalid table entry";if(o.lit++,o.p){var s=o.p;o.p=Array(o.lit);for(var l=0;l<o.lit-1;++l)o.p[l]=s[l]}else o.p=[,];o.p[o.lit-1]=t}else if(i)for(var c=0,l=1<<14-i;l>0;l--){var o=n[(a<<14-i)+c];if(o.len||o.p)throw"Invalid table entry";o.len=i,o.lit=t,c++}}}(g,h,m,w),function(e,t,r,n,s,c,u,f,d,p){for(var h=0,m=0,v=Math.trunc(s.value+(c+7)/8);s.value<v;)for(i(h,m,r,s),h=a.c,m=a.lc;m>=14;){var g=t[h>>m-14&16383];if(g.len)m-=g.len,l(g.lit,u,h,m,r,n,s,d,p,f),h=o.c,m=o.lc;else{if(!g.p)throw"hufDecode issues";for(w=0;w<g.lit;w++){for(var w,y=63&e[g.p[w]];m<y&&s.value<v;)i(h,m,r,s),h=a.c,m=a.lc;if(m>=y&&e[g.p[w]]>>6==(h>>m-y&(1<<y)-1)){m-=y,l(g.p[w],u,h,m,r,n,s,d,p,f),h=o.c,m=o.lc;break}}if(w==g.lit)throw"hufDecode issues"}}var b=8-c&7;for(h>>=b,m-=b;m>0;){var g=t[h<<14-m&16383];if(g.len)m-=g.len,l(g.lit,u,h,m,r,n,s,d,p,f),h=o.c,m=o.lc;else throw"hufDecode issues"}}(g,w,e,s,c,v,m,d,f,{value:0})}function h(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function m(e,t){for(var r=0,n=Math.floor((e.length+1)/2),a=0,i=e.length-1;!(a>i)&&(t[a++]=e[r++],!(a>i));){;t[a++]=e[n++]}}function v(e){for(var t=e.byteLength,r=[],n=0,a=new DataView(e);t>0;){var i=a.getInt8(n++);if(i<0){var o=-i;t-=o+1;for(var s=0;s<o;s++)r.push(a.getUint8(n++))}else{var o=i;t-=2;for(var l=a.getUint8(n++),s=0;s<o+1;s++)r.push(l)}}return r}function g(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function w(e){var t=new Uint8Array(v(e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size))),r=new Uint8Array(t.length);return h(t),m(t,r),new DataView(r.buffer)}function y(e){var t=D(e.array.slice(e.offset.value,e.offset.value+e.size)),r=new Uint8Array(t.length);return h(t),m(t,r),new DataView(r.buffer)}function b(e){for(var t=e.viewer,r={value:e.offset.value},n=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),a=new Uint8Array(8192),i=0,o=Array(e.channels),s=0;s<e.channels;s++)o[s]={},o[s].start=i,o[s].end=o[s].start,o[s].nx=e.width,o[s].ny=e.lines,o[s].size=e.type,i+=o[s].nx*o[s].ny*o[s].size;var l=T(t,r),c=T(t,r);if(c>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(l<=c)for(var s=0;s<c-l+1;s++)a[s+l]=P(t,r);var h=new Uint16Array(65536),m=function(e,t){for(var r=0,n=0;n<65536;++n)(0==n||e[n>>3]&1<<(7&n))&&(t[r++]=n);for(var a=r-1;r<65536;)t[r++]=0;return a}(a,h),v=C(t,r);p(e.array,t,r,v,n,i);for(var s=0;s<e.channels;++s)for(var g=o[s],w=0;w<o[s].size;++w)!function(e,t,r,n,a,i,o){for(var s=o<16384,l=r>a?a:r,c=1;c<=l;)c<<=1;for(c>>=1,p=c,c>>=1;c>=1;){for(var p,h,m,v,g,w=0,y=0+i*(a-p),b=i*c,x=i*p,M=n*c,S=n*p;w<=y;w+=x){for(var _=w,C=w+n*(r-p);_<=C;_+=S){var E=_+M,P=_+b,R=P+M;s?(f(e[_+t],e[P+t]),h=u.a,v=u.b,f(e[E+t],e[R+t]),m=u.a,g=u.b,f(h,m),e[_+t]=u.a,e[E+t]=u.b,f(v,g)):(d(e[_+t],e[P+t]),h=u.a,v=u.b,d(e[E+t],e[R+t]),m=u.a,g=u.b,d(h,m),e[_+t]=u.a,e[E+t]=u.b,d(v,g)),e[P+t]=u.a,e[R+t]=u.b}if(r&c){var P=_+b;s?f(e[_+t],e[P+t]):d(e[_+t],e[P+t]),h=u.a,e[P+t]=u.b,e[_+t]=h}}if(a&c)for(var _=w,C=w+n*(r-p);_<=C;_+=S){var E=_+M;s?f(e[_+t],e[E+t]):d(e[_+t],e[E+t]),h=u.a,e[E+t]=u.b,e[_+t]=h}p=c,c>>=1}}(n,g.start+w,g.nx,g.size,g.ny,g.nx*g.size,m);for(var y=i,b=0;b<y;++b)n[b]=h[n[b]];for(var x=0,M=new Uint8Array(n.buffer.byteLength),S=0;S<e.lines;S++)for(var _=0;_<e.channels;_++){var g=o[_],E=g.nx*g.size,R=new Uint8Array(n.buffer,2*g.end,2*E);M.set(R,x),x+=2*E,g.end+=E}return new DataView(M.buffer)}function x(e){var t=D(e.array.slice(e.offset.value,e.offset.value+e.size));let r=e.lines*e.channels*e.width,n=1==e.type?new Uint16Array(r):new Uint32Array(r),a=0,i=0,o=[,,,,];for(let r=0;r<e.lines;r++)for(let r=0;r<e.channels;r++){let r=0;switch(e.type){case 1:o[0]=a,o[1]=o[0]+e.width,a=o[1]+e.width;for(let a=0;a<e.width;++a)r+=t[o[0]++]<<8|t[o[1]++],n[i]=r,i++;break;case 2:o[0]=a,o[1]=o[0]+e.width,o[2]=o[1]+e.width,a=o[2]+e.width;for(let a=0;a<e.width;++a)r+=t[o[0]++]<<24|t[o[1]++]<<16|t[o[2]++]<<8,n[i]=r,i++}}return new DataView(n.buffer)}function M(e){var t=e.viewer,r={value:e.offset.value},n=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),a={version:R(t,r),unknownUncompressedSize:R(t,r),unknownCompressedSize:R(t,r),acCompressedSize:R(t,r),dcCompressedSize:R(t,r),rleCompressedSize:R(t,r),rleUncompressedSize:R(t,r),rleRawSize:R(t,r),totalAcUncompressedCount:R(t,r),totalDcUncompressedCount:R(t,r),acCompression:R(t,r)};if(a.version<2)throw"EXRLoader.parse: "+z.compression+" version "+a.version+" is unsupported";for(var i=[],o=T(t,r)-2;o>0;){var l=S(t.buffer,r),c=P(t,r),u=c>>2&3,f=new Int8Array([(c>>4)-1])[0],d=P(t,r);i.push({name:l,index:f,type:d,compression:u}),o-=l.length+3}for(var h=z.channels,m=Array(e.channels),g=0;g<e.channels;++g){var w=m[g]={},b=h[g];w.name=b.name,w.compression=0,w.decoded=!1,w.type=b.pixelType,w.pLinear=b.pLinear,w.width=e.width,w.height=e.lines}for(var x={idx:[,,,]},M=0;M<e.channels;++M)for(var w=m[M],g=0;g<i.length;++g){var _=i[g];w.name==_.name&&(w.compression=_.compression,_.index>=0&&(x.idx[_.index]=M),w.offset=M)}if(a.acCompressedSize>0)switch(a.acCompression){case 0:var C=new Uint16Array(a.totalAcUncompressedCount);p(e.array,t,r,a.acCompressedSize,C,a.totalAcUncompressedCount);break;case 1:var E=e.array.slice(r.value,r.value+a.totalAcUncompressedCount),k=D(E),C=new Uint16Array(k.buffer);r.value+=a.totalAcUncompressedCount}if(a.dcCompressedSize>0){var j=new Uint16Array(y({array:e.array,offset:r,size:a.dcCompressedSize}).buffer);r.value+=a.dcCompressedSize}if(a.rleRawSize>0){var E=e.array.slice(r.value,r.value+a.rleCompressedSize),k=D(E),A=v(k.buffer);r.value+=a.rleCompressedSize}for(var O=0,F=Array(m.length),g=0;g<F.length;++g)F[g]=[];for(var U=0;U<e.lines;++U)for(var B=0;B<m.length;++B)F[B].push(O),O+=m[B].width*e.type*2;!function(e,t,r,n,a,i){var o=new DataView(i.buffer),l=r[e.idx[0]].width,c=r[e.idx[0]].height,u=Math.floor(l/8),f=Math.ceil(l/8),d=Math.ceil(c/8),p=l-(f-1)*8,h=c-(d-1)*8,m={value:0},v=[,,,],g=[,,,],w=[,,,],y=[,,,],b=[,,,];for(let r=0;r<3;++r)b[r]=t[e.idx[r]],v[r]=r<1?0:v[r-1]+f*d,g[r]=new Float32Array(64),w[r]=new Uint16Array(64),y[r]=new Uint16Array(64*f);for(let t=0;t<d;++t){var x,M,S=8;t==d-1&&(S=h);var _=8;for(let e=0;e<f;++e){e==f-1&&(_=p);for(let e=0;e<3;++e){w[e].fill(0),w[e][0]=a[v[e]++],function(e,t,r){for(var n,a=1;a<64;)65280==(n=t[e.value])?a=64:n>>8==255?a+=255&n:(r[a]=n,a++),e.value++}(m,n,w[e]),x=w[e],(M=g[e])[0]=I(x[0]),M[1]=I(x[1]),M[2]=I(x[5]),M[3]=I(x[6]),M[4]=I(x[14]),M[5]=I(x[15]),M[6]=I(x[27]),M[7]=I(x[28]),M[8]=I(x[2]),M[9]=I(x[4]),M[10]=I(x[7]),M[11]=I(x[13]),M[12]=I(x[16]),M[13]=I(x[26]),M[14]=I(x[29]),M[15]=I(x[42]),M[16]=I(x[3]),M[17]=I(x[8]),M[18]=I(x[12]),M[19]=I(x[17]),M[20]=I(x[25]),M[21]=I(x[30]),M[22]=I(x[41]),M[23]=I(x[43]),M[24]=I(x[9]),M[25]=I(x[11]),M[26]=I(x[18]),M[27]=I(x[24]),M[28]=I(x[31]),M[29]=I(x[40]),M[30]=I(x[44]),M[31]=I(x[53]),M[32]=I(x[10]),M[33]=I(x[19]),M[34]=I(x[23]),M[35]=I(x[32]),M[36]=I(x[39]),M[37]=I(x[45]),M[38]=I(x[52]),M[39]=I(x[54]),M[40]=I(x[20]),M[41]=I(x[22]),M[42]=I(x[33]),M[43]=I(x[38]),M[44]=I(x[46]),M[45]=I(x[51]),M[46]=I(x[55]),M[47]=I(x[60]),M[48]=I(x[21]),M[49]=I(x[34]),M[50]=I(x[37]),M[51]=I(x[47]),M[52]=I(x[50]),M[53]=I(x[56]),M[54]=I(x[59]),M[55]=I(x[61]),M[56]=I(x[35]),M[57]=I(x[36]),M[58]=I(x[48]),M[59]=I(x[49]),M[60]=I(x[57]),M[61]=I(x[58]),M[62]=I(x[62]),M[63]=I(x[63]),function(e){let t=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),n=.5*Math.cos(3*3.14159/16),a=.5*Math.cos(3*3.14159/8);for(var i=[,,,,],o=[,,,,],s=[,,,,],l=[,,,,],c=0;c<8;++c){var u=8*c;i[0]=r*e[u+2],i[1]=a*e[u+2],i[2]=r*e[u+6],i[3]=a*e[u+6],o[0]=t*e[u+1]+n*e[u+3]+.2777854612564676*e[u+5]+.09754573032714427*e[u+7],o[1]=n*e[u+1]-.09754573032714427*e[u+3]-t*e[u+5]-.2777854612564676*e[u+7],o[2]=.2777854612564676*e[u+1]-t*e[u+3]+.09754573032714427*e[u+5]+n*e[u+7],o[3]=.09754573032714427*e[u+1]-.2777854612564676*e[u+3]+n*e[u+5]-t*e[u+7],s[0]=.35355362513961314*(e[u+0]+e[u+4]),s[3]=.35355362513961314*(e[u+0]-e[u+4]),s[1]=i[0]+i[3],s[2]=i[1]-i[2],l[0]=s[0]+s[1],l[1]=s[3]+s[2],l[2]=s[3]-s[2],l[3]=s[0]-s[1],e[u+0]=l[0]+o[0],e[u+1]=l[1]+o[1],e[u+2]=l[2]+o[2],e[u+3]=l[3]+o[3],e[u+4]=l[3]-o[3],e[u+5]=l[2]-o[2],e[u+6]=l[1]-o[1],e[u+7]=l[0]-o[0]}for(var f=0;f<8;++f)i[0]=r*e[16+f],i[1]=a*e[16+f],i[2]=r*e[48+f],i[3]=a*e[48+f],o[0]=t*e[8+f]+n*e[24+f]+.2777854612564676*e[40+f]+.09754573032714427*e[56+f],o[1]=n*e[8+f]-.09754573032714427*e[24+f]-t*e[40+f]-.2777854612564676*e[56+f],o[2]=.2777854612564676*e[8+f]-t*e[24+f]+.09754573032714427*e[40+f]+n*e[56+f],o[3]=.09754573032714427*e[8+f]-.2777854612564676*e[24+f]+n*e[40+f]-t*e[56+f],s[0]=.35355362513961314*(e[f]+e[32+f]),s[3]=.35355362513961314*(e[f]-e[32+f]),s[1]=i[0]+i[3],s[2]=i[1]-i[2],l[0]=s[0]+s[1],l[1]=s[3]+s[2],l[2]=s[3]-s[2],l[3]=s[0]-s[1],e[0+f]=l[0]+o[0],e[8+f]=l[1]+o[1],e[16+f]=l[2]+o[2],e[24+f]=l[3]+o[3],e[32+f]=l[3]-o[3],e[40+f]=l[2]-o[2],e[48+f]=l[1]-o[1],e[56+f]=l[0]-o[0]}(g[e])}for(var C=g,E=0;E<64;++E){var P=C[0][E],R=C[1][E],k=C[2][E];C[0][E]=P+1.5747*k,C[1][E]=P-.1873*R-.4682*k,C[2][E]=P+1.8556*R}for(let t=0;t<3;++t)!function(e,t,r){for(var n,a=0;a<64;++a){t[r+a]=s.GxU.toHalfFloat((n=e[a])<=1?Math.sign(n)*Math.pow(Math.abs(n),2.2):Math.sign(n)*Math.pow(9.025013291561939,Math.abs(n)-1))}}(g[t],y[t],64*e)}let i=0;for(let n=0;n<3;++n){let a=r[e.idx[n]].type;for(let e=8*t;e<8*t+S;++e){i=b[n][e];for(let t=0;t<u;++t){let r=64*t+(7&e)*8;o.setUint16(i+0*a,y[n][r+0],!0),o.setUint16(i+2*a,y[n][r+1],!0),o.setUint16(i+4*a,y[n][r+2],!0),o.setUint16(i+6*a,y[n][r+3],!0),o.setUint16(i+8*a,y[n][r+4],!0),o.setUint16(i+10*a,y[n][r+5],!0),o.setUint16(i+12*a,y[n][r+6],!0),o.setUint16(i+14*a,y[n][r+7],!0),i+=16*a}}if(u!=f)for(let e=8*t;e<8*t+S;++e){let t=b[n][e]+8*u*2*a,r=64*u+(7&e)*8;for(let e=0;e<_;++e)o.setUint16(t+2*e*a,y[n][r+e],!0)}}}for(var j=new Uint16Array(l),o=new DataView(i.buffer),T=0;T<3;++T){r[e.idx[T]].decoded=!0;var A=r[e.idx[T]].type;if(2==r[T].type)for(var O=0;O<c;++O){let e=b[T][O];for(var F=0;F<l;++F)j[F]=o.getUint16(e+2*F*A,!0);for(var F=0;F<l;++F)o.setFloat32(e+2*F*A,I(j[F]),!0)}}}(x,F,m,C,j,n);for(var g=0;g<m.length;++g){var w=m[g];if(!w.decoded)if(2===w.compression)for(var L=0,N=0,U=0;U<e.lines;++U){for(var H=F[g][L],q=0;q<w.width;++q){for(var G=0;G<2*w.type;++G)n[H++]=A[N+G*w.width*w.height];N++}L++}else throw"EXRLoader.parse: unsupported channel compression"}return new DataView(n.buffer)}function S(e,t){for(var r=new Uint8Array(e),n=0;0!=r[t.value+n];)n+=1;var a=new TextDecoder().decode(r.slice(t.value,t.value+n));return t.value=t.value+n+1,a}function _(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function C(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function E(e,t){var r=e[t.value];return t.value=t.value+1,r}function P(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}let R=function(e,t){let r;return r="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function k(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function j(e,t){return s.GxU.toHalfFloat(k(e,t))}function I(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function T(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function A(e,t){return I(T(e,t))}let O=new DataView(e),F=new Uint8Array(e),U={value:0},z=function(e,t,r){let n={};if(0x1312f76!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";n.version=e.getUint8(4);let a=e.getUint8(5);n.spec={singleTile:!!(2&a),longName:!!(4&a),deepFormat:!!(8&a),multiPart:!!(16&a)},r.value=8;for(var i=!0;i;){var o=S(t,r);if(0==o)i=!1;else{var s=S(t,r),l=C(e,r),c=function(e,t,r,n,a){var i,o,s,l,c,u,f;if("string"===n||"stringvector"===n||"iccProfile"===n)return i=new TextDecoder().decode(new Uint8Array(t).slice(r.value,r.value+a)),r.value=r.value+a,i;if("chlist"===n)return function(e,t,r,n){for(var a=r.value,i=[];r.value<a+n-1;){var o=S(t,r),s=_(e,r),l=P(e,r);r.value+=3;var c=_(e,r),u=_(e,r);i.push({name:o,pixelType:s,pLinear:l,xSampling:c,ySampling:u})}return r.value+=1,i}(e,t,r,a);if("chromaticities"===n)return o=k(e,r),s=k(e,r),l=k(e,r),c=k(e,r),u=k(e,r),{redX:o,redY:s,greenX:l,greenY:c,blueX:u,blueY:k(e,r),whiteX:k(e,r),whiteY:k(e,r)};if("compression"===n)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][P(e,r)];if("box2i"===n)return f=C(e,r),{xMin:f,yMin:C(e,r),xMax:C(e,r),yMax:C(e,r)};else if("lineOrder"===n)return["INCREASING_Y"][P(e,r)];else if("float"===n)return k(e,r);else if("v2f"===n)return[k(e,r),k(e,r)];else if("v3f"===n)return[k(e,r),k(e,r),k(e,r)];else if("int"===n)return _(e,r);else if("rational"===n)return[_(e,r),C(e,r)];else if("timecode"===n)return[C(e,r),C(e,r)];else return"preview"===n?(r.value+=a,"skipped"):(r.value+=a,void 0)}(e,t,r,s,l);void 0===c?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${s}'.`):n[o]=c}}if((-5&a)!=0)throw console.error("EXRHeader:",n),"THREE.EXRLoader: provided file is currently unsupported.";return n}(O,e,U),B=function(e,t,r,n,a){let i={size:0,viewer:t,array:r,offset:n,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[L?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":i.lines=1,i.uncompress=g;break;case"RLE_COMPRESSION":i.lines=1,i.uncompress=w;break;case"ZIPS_COMPRESSION":i.lines=1,i.uncompress=y;break;case"ZIP_COMPRESSION":i.lines=16,i.uncompress=y;break;case"PIZ_COMPRESSION":i.lines=32,i.uncompress=b;break;case"PXR24_COMPRESSION":i.lines=16,i.uncompress=x;break;case"DWAA_COMPRESSION":i.lines=32,i.uncompress=M;break;case"DWAB_COMPRESSION":i.lines=256,i.uncompress=M;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(i.scanlineBlockSize=i.lines,1==i.type)switch(a){case s.RQf:i.getter=A,i.inputSize=2;break;case s.ix0:i.getter=T,i.inputSize=2}else if(2==i.type)switch(a){case s.RQf:i.getter=k,i.inputSize=4;break;case s.ix0:i.getter=j,i.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+i.type+" for "+e.compression+".";i.blockCount=(e.dataWindow.yMax+1)/i.scanlineBlockSize;for(var o=0;o<i.blockCount;o++)R(t,n);i.outputChannels=3==i.channels?4:i.channels;let l=i.width*i.height*i.outputChannels;switch(a){case s.RQf:i.byteArray=new Float32Array(l),i.channels<i.outputChannels&&i.byteArray.fill(1,0,l);break;case s.ix0:i.byteArray=new Uint16Array(l),i.channels<i.outputChannels&&i.byteArray.fill(15360,0,l);break;default:console.error("THREE.EXRLoader: unsupported type: ",a)}return i.bytesPerLine=i.width*i.inputSize*i.channels,4==i.outputChannels?i.format=s.GWd:i.format=s.VT0,L?i.colorSpace="srgb-linear":i.encoding=3e3,i}(z,O,F,U,this.type),N={value:0},H={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<B.height/B.scanlineBlockSize;e++){let t=C(O,U);B.size=C(O,U),B.lines=t+B.scanlineBlockSize>B.height?B.height-t:B.scanlineBlockSize;let r=B.size<B.lines*B.bytesPerLine?B.uncompress(B):g(B);U.value+=B.size;for(let t=0;t<B.scanlineBlockSize;t++){let n=t+e*B.scanlineBlockSize;if(n>=B.height)break;for(let e=0;e<B.channels;e++){let a=H[z.channels[e].name];for(let i=0;i<B.width;i++){N.value=(t*(B.channels*B.width)+e*B.width+i)*B.inputSize;let o=(B.height-1-n)*(B.width*B.outputChannels)+i*B.outputChannels+a;B.byteArray[o]=B.getter(r,N)}}}}return{header:z,width:B.width,height:B.height,data:B.byteArray,format:B.format,[L?"colorSpace":"encoding"]:B[L?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,function(e,r){L?e.colorSpace=r.colorSpace:e.encoding=r.encoding,e.minFilter=s.k6q,e.magFilter=s.k6q,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)},r,n)}}var H=r(7431);let q=(e,t,r)=>{let n;switch(e){case s.OUM:n=new Uint8ClampedArray(t*r*4);break;case s.ix0:n=new Uint16Array(t*r*4);break;case s.bkx:n=new Uint32Array(t*r*4);break;case s.tJf:n=new Int8Array(t*r*4);break;case s.fBL:n=new Int16Array(t*r*4);break;case s.Yuy:n=new Int32Array(t*r*4);break;case s.RQf:n=new Float32Array(t*r*4);break;default:throw Error("Unsupported data type")}return n};class G{constructor(e){var t,r,a,i,o,l,c,u,f,d,p,h,m,v,g,w;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;let y={format:s.GWd,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:(null==(t=e.renderTargetOptions)?void 0:t.anisotropy)!==void 0?null==(r=e.renderTargetOptions)?void 0:r.anisotropy:1,generateMipmaps:(null==(a=e.renderTargetOptions)?void 0:a.generateMipmaps)!==void 0&&(null==(i=e.renderTargetOptions)?void 0:i.generateMipmaps),magFilter:(null==(o=e.renderTargetOptions)?void 0:o.magFilter)!==void 0?null==(l=e.renderTargetOptions)?void 0:l.magFilter:s.k6q,minFilter:(null==(c=e.renderTargetOptions)?void 0:c.minFilter)!==void 0?null==(u=e.renderTargetOptions)?void 0:u.minFilter:s.k6q,samples:(null==(f=e.renderTargetOptions)?void 0:f.samples)!==void 0?null==(d=e.renderTargetOptions)?void 0:d.samples:void 0,wrapS:(null==(p=e.renderTargetOptions)?void 0:p.wrapS)!==void 0?null==(h=e.renderTargetOptions)?void 0:h.wrapS:s.ghU,wrapT:(null==(m=e.renderTargetOptions)?void 0:m.wrapT)!==void 0?null==(v=e.renderTargetOptions)?void 0:v.wrapT:s.ghU};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=G.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new s.Z58,this._camera=new s.qUd,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((e,t,r,a)=>{if(void 0!==n)return n;let i=new s.nWS(1,1,a);t.setRenderTarget(i);let o=new s.eaF(new s.bdM,new s.V9B({color:0xffffff}));t.render(o,r),t.setRenderTarget(null);let l=q(e,i.width,i.height);return t.readRenderTargetPixels(i,0,0,i.width,i.height,l),i.dispose(),o.geometry.dispose(),o.material.dispose(),n=0!==l[0]})(this._type,this._renderer,this._camera,y)){let e;this._type===s.ix0&&(e=this._renderer.extensions.has("EXT_color_buffer_float")?s.RQf:void 0),void 0!==e?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${s.RQf}`),this._type=e):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new s.eaF(new s.bdM,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new s.nWS(this.width,this.height,y),this._renderTarget.texture.mapping=(null==(g=e.renderTargetOptions)?void 0:g.mapping)!==void 0?null==(w=e.renderTargetOptions)?void 0:w.mapping:s.UTZ}static instantiateRenderer(){let e=new H.WebGLRenderer;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw Error("Can't read pixels in this browser");let e=q(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){let t=new s.GYF(this.toArray(),this.width,this.height,s.GWd,this._type,(null==e?void 0:e.mapping)||s.UTZ,(null==e?void 0:e.wrapS)||s.ghU,(null==e?void 0:e.wrapT)||s.ghU,(null==e?void 0:e.magFilter)||s.k6q,(null==e?void 0:e.minFilter)||s.k6q,(null==e?void 0:e.anisotropy)||1,s.Zr2);return t.generateMipmaps=(null==e?void 0:e.generateMipmaps)!==void 0&&(null==e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof s.BKk&&Object.values(this.material.uniforms).forEach(e=>{e.value instanceof s.gPd&&e.value.dispose()}),Object.values(this.material).forEach(e=>{e instanceof s.gPd&&e.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}let W=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,$=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class V extends s.BKk{constructor({gamma:e,offsetHdr:t,offsetSdr:r,gainMapMin:n,gainMapMax:a,maxDisplayBoost:i,hdrCapacityMin:o,hdrCapacityMax:l,sdr:c,gainMap:u}){super({name:"GainMapDecoderMaterial",vertexShader:W,fragmentShader:$,uniforms:{sdr:{value:c},gainMap:{value:u},gamma:{value:new s.Pq0(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new s.Pq0().fromArray(t)},offsetSdr:{value:new s.Pq0().fromArray(r)},gainMapMin:{value:new s.Pq0().fromArray(n)},gainMapMax:{value:new s.Pq0().fromArray(a)},weightFactor:{value:(Math.log2(i)-o)/(l-o)}},blending:s.XIg,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=i,this._hdrCapacityMin=o,this._hdrCapacityMax=l,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){let e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){let t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){let e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class Y extends Error{}class X extends Error{}let Z=(e,t,r)=>{let n=RegExp(`${t}="([^"]*)"`,"i").exec(e);if(n)return n[1];let a=RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(a){let e=a[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map(e=>e.replace(/<\/?rdf:li>/g,"")):a[1].trim()}if(void 0!==r)return r;throw Error(`Can't find ${t} in gainmap metadata`)};class Q{constructor(e){this.options={debug:!!e&&void 0!==e.debug&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise((t,r)=>{let n,a=this.options.debug,i=new DataView(e.buffer);if(65496!==i.getUint16(0))return void r(Error("Not a valid jpeg"));let o=i.byteLength,s=2,l=0;for(;s<o;){if(++l>250)return void r(Error(`Found no marker after ${l} loops ðŸ˜µ`));if(255!==i.getUint8(s))return void r(Error(`Not a valid marker at offset 0x${s.toString(16)}, found: 0x${i.getUint8(s).toString(16)}`));if(n=i.getUint8(s+1),a&&console.log(`Marker: ${n.toString(16)}`),226===n){a&&console.log("Found APP2 marker (0xffe2)");let e=s+4;if(0x4d504600===i.getUint32(e)){let n,a=e+4;if(18761===i.getUint16(a))n=!1;else{if(19789!==i.getUint16(a))return void r(Error("No valid endianness marker found in TIFF header"));n=!0}if(42!==i.getUint16(a+2,!n))return void r(Error("Not valid TIFF data! (no 0x002A marker)"));let o=i.getUint32(a+4,!n);if(o<8)return void r(Error("Not valid TIFF data! (First offset less than 8)"));let s=a+o,l=i.getUint16(s,!n),c=s+2,u=0;for(let e=c;e<c+12*l;e+=12)45057===i.getUint16(e,!n)&&(u=i.getUint32(e+8,!n));let f=s+2+12*l+4,d=[];for(let e=f;e<f+16*u;e+=16){let t={MPType:i.getUint32(e,!n),size:i.getUint32(e+4,!n),dataOffset:i.getUint32(e+8,!n),dependantImages:i.getUint32(e+12,!n),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=a+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,d.push(t)}if(this.options.extractNonFII&&d.length){let e=new Blob([i]),r=[];for(let t of d){if(t.isFII&&!this.options.extractFII)continue;let n=e.slice(t.start,t.end+1,"image/jpeg");r.push(n)}t(r)}}}s+=2+i.getUint16(s+2)}})}}let K=async e=>{let t=(e=>{let t,r=(t="undefined"!=typeof TextDecoder?new TextDecoder().decode(e):e.toString()).indexOf("<x:xmpmeta");for(;-1!==r;){let e=t.indexOf("x:xmpmeta>",r),n=t.slice(r,e+10);try{let e=Z(n,"hdrgm:GainMapMin","0"),t=Z(n,"hdrgm:GainMapMax"),r=Z(n,"hdrgm:Gamma","1"),a=Z(n,"hdrgm:OffsetSDR","0.015625"),i=Z(n,"hdrgm:OffsetHDR","0.015625"),o=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(n),s=o?o[1]:"0",l=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(n);if(!l)throw Error("Incomplete gainmap metadata");let c=l[1];return{gainMapMin:Array.isArray(e)?e.map(e=>parseFloat(e)):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map(e=>parseFloat(e)):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(r)?r.map(e=>parseFloat(e)):[parseFloat(r),parseFloat(r),parseFloat(r)],offsetSdr:Array.isArray(a)?a.map(e=>parseFloat(e)):[parseFloat(a),parseFloat(a),parseFloat(a)],offsetHdr:Array.isArray(i)?i.map(e=>parseFloat(e)):[parseFloat(i),parseFloat(i),parseFloat(i)],hdrCapacityMin:parseFloat(s),hdrCapacityMax:parseFloat(c)}}catch(e){}r=t.indexOf("<x:xmpmeta",e)}})(e);if(!t)throw new X("Gain map XMP metadata not found");let r=new Q({extractFII:!0,extractNonFII:!0}),n=await r.extract(e);if(2!==n.length)throw new Y("Gain map recovery image not found");return{sdr:new Uint8Array(await n[0].arrayBuffer()),gainMap:new Uint8Array(await n[1].arrayBuffer()),metadata:t}},J=e=>new Promise((t,r)=>{let n=document.createElement("img");n.onload=()=>{t(n)},n.onerror=e=>{r(e)},n.src=URL.createObjectURL(e)});class ee extends s.aHM{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new s.KPJ}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");let e=new V({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new s.gPd,sdr:new s.gPd});return new G({width:16,height:16,type:s.ix0,colorSpace:s.Zr2,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,r,n){let a,i,o=n?new Blob([n],{type:"image/jpeg"}):void 0,l=new Blob([r],{type:"image/jpeg"}),c=!1;if("undefined"==typeof createImageBitmap){let e=await Promise.all([o?J(o):Promise.resolve(void 0),J(l)]);i=e[0],a=e[1],c=!0}else{let e=await Promise.all([o?createImageBitmap(o,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(l,{imageOrientation:"flipY"})]);i=e[0],a=e[1]}let u=new s.gPd(i||new ImageData(2,2),s.UTZ,s.ghU,s.ghU,s.k6q,s.NZq,s.GWd,s.OUM,1,s.Zr2);u.flipY=c,u.needsUpdate=!0;let f=new s.gPd(a,s.UTZ,s.ghU,s.ghU,s.k6q,s.NZq,s.GWd,s.OUM,1,s.er$);f.flipY=c,f.needsUpdate=!0,e.width=a.width,e.height=a.height,e.material.gainMap=u,e.material.sdr=f,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class et extends ee{load([e,t,r],n,a,i){let o,l,c,u=this.prepareQuadRenderer(),f=async()=>{if(o&&l&&c){try{await this.render(u,c,o,l)}catch(n){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(r),"function"==typeof i&&i(n),u.disposeOnDemandRenderer();return}"function"==typeof n&&n(u),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(r),u.disposeOnDemandRenderer()}},d=!0,p=0,h=0,m=!0,v=0,g=0,w=!0,y=0,b=0,x=()=>{"function"==typeof a&&a(new ProgressEvent("progress",{lengthComputable:d&&m&&w,loaded:h+g+b,total:p+v+y}))};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(r);let M=new s.Y9S(this._internalLoadingManager);M.setResponseType("arraybuffer"),M.setRequestHeader(this.requestHeader),M.setPath(this.path),M.setWithCredentials(this.withCredentials),M.load(e,async e=>{if("string"==typeof e)throw Error("Invalid sdr buffer");o=e,await f()},e=>{d=e.lengthComputable,h=e.loaded,p=e.total,x()},t=>{this.manager.itemError(e),"function"==typeof i&&i(t)});let S=new s.Y9S(this._internalLoadingManager);S.setResponseType("arraybuffer"),S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(t,async e=>{if("string"==typeof e)throw Error("Invalid gainmap buffer");l=e,await f()},e=>{m=e.lengthComputable,g=e.loaded,v=e.total,x()},e=>{this.manager.itemError(t),"function"==typeof i&&i(e)});let _=new s.Y9S(this._internalLoadingManager);return _.setRequestHeader(this.requestHeader),_.setPath(this.path),_.setWithCredentials(this.withCredentials),_.load(r,async e=>{if("string"!=typeof e)throw Error("Invalid metadata string");c=JSON.parse(e),await f()},e=>{w=e.lengthComputable,b=e.loaded,y=e.total,x()},e=>{this.manager.itemError(r),"function"==typeof i&&i(e)}),u}}class er extends ee{load(e,t,r,n){let a=this.prepareQuadRenderer(),i=new s.Y9S(this._internalLoadingManager);return i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setPath(this.path),i.setWithCredentials(this.withCredentials),this.manager.itemStart(e),i.load(e,async r=>{let i,o,s;if("string"==typeof r)throw Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");let l=new Uint8Array(r);try{let e=await K(l);i=e.sdr,o=e.gainMap,s=e.metadata}catch(t){if(t instanceof X||t instanceof Y)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),s={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},i=l;else throw t}try{await this.render(a,s,i,o)}catch(t){this.manager.itemError(e),"function"==typeof n&&n(t),a.disposeOnDemandRenderer();return}"function"==typeof t&&t(a),this.manager.itemEnd(e),a.disposeOnDemandRenderer()},r,t=>{this.manager.itemError(e),"function"==typeof n&&n(t)}),a}}let en={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},ea="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",ei=e=>Array.isArray(e),eo=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function es({files:e=eo,path:t="",preset:r,colorSpace:n,extensions:a}={}){r&&(eu(r),e=en[r],t=ea);let l=ei(e),{extension:c,isCubemap:u}=ef(e),f=ed(c);if(!f)throw Error("useEnvironment: Unrecognized file extension: "+e);let d=(0,o.C)(e=>e.gl);(0,i.useLayoutEffect)(()=>{("webp"===c||"jpg"===c||"jpeg"===c)&&d.domElement.addEventListener("webglcontextlost",function(){o.G.clear(f,l?[e]:e)},{once:!0})},[e,d.domElement]);let p=(0,o.G)(f,l?[e]:e,e=>{("webp"===c||"jpg"===c||"jpeg"===c)&&e.setRenderer(d),null==e.setPath||e.setPath(t),a&&a(e)}),h=l?p[0]:p;if("jpg"===c||"jpeg"===c||"webp"===c){var m;h=null==(m=h.renderTarget)?void 0:m.texture}return h.mapping=u?s.hy7:s.wfO,h.colorSpace=null!=n?n:u?"srgb":"srgb-linear",h}let el={files:eo,path:"",preset:void 0,extensions:void 0};es.preload=e=>{let t={...el,...e},{files:r,path:n=""}=t,{preset:a,extensions:i}=t;a&&(eu(a),r=en[a],n=ea);let{extension:s}=ef(r);if("webp"===s||"jpg"===s||"jpeg"===s)throw Error("useEnvironment: Preloading gainmaps is not supported");let l=ed(s);if(!l)throw Error("useEnvironment: Unrecognized file extension: "+r);o.G.preload(l,ei(r)?[r]:r,e=>{null==e.setPath||e.setPath(n),i&&i(e)})};let ec={files:eo,preset:void 0};function eu(e){if(!(e in en))throw Error("Preset must be one of: "+Object.keys(en).join(", "))}function ef(e){var t;let r=ei(e)&&6===e.length,n=ei(e)&&3===e.length&&e.some(e=>e.endsWith("json")),a=ei(e)?e[0]:e;return{extension:r?"cube":n?"webp":a.startsWith("data:application/exr")?"exr":a.startsWith("data:application/hdr")?"hdr":a.startsWith("data:image/jpeg")?"jpg":null==(t=a.split(".").pop())||null==(t=t.split("?"))||null==(t=t.shift())?void 0:t.toLowerCase(),isCubemap:r,isGainmap:n}}function ed(e){return"cube"===e?s.ScU:"hdr"===e?u:"exr"===e?N:"jpg"===e||"jpeg"===e?er:"webp"===e?et:null}function ep(e,t,r,n,a={}){var i,s,l,c;let u,f;a={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...a};let d=(f=u=t||r).current&&f.current.isScene?u.current:u,p=d.background,h=d.environment,m={backgroundBlurriness:d.backgroundBlurriness,backgroundIntensity:d.backgroundIntensity,backgroundRotation:null!=(i=null==(s=d.backgroundRotation)||null==s.clone?void 0:s.clone())?i:[0,0,0],environmentIntensity:d.environmentIntensity,environmentRotation:null!=(l=null==(c=d.environmentRotation)||null==c.clone?void 0:c.clone())?l:[0,0,0]};return"only"!==e&&(d.environment=n),e&&(d.background=n),(0,o.s)(d,a),()=>{"only"!==e&&(d.environment=h),e&&(d.background=p),(0,o.s)(d,m)}}function eh({scene:e,background:t=!1,map:r,...n}){let a=(0,o.C)(e=>e.scene);return i.useLayoutEffect(()=>{if(r)return ep(t,e,a,r,n)}),null}function em({background:e=!1,scene:t,blur:r,backgroundBlurriness:n,backgroundIntensity:a,backgroundRotation:s,environmentIntensity:l,environmentRotation:c,...u}){let f=es(u),d=(0,o.C)(e=>e.scene);return i.useLayoutEffect(()=>ep(e,t,d,f,{backgroundBlurriness:null!=r?r:n,backgroundIntensity:a,backgroundRotation:s,environmentIntensity:l,environmentRotation:c})),i.useEffect(()=>()=>{f.dispose()},[f]),null}function ev({children:e,near:t=.1,far:r=1e3,resolution:n=256,frames:a=1,map:l,background:c=!1,blur:u,backgroundBlurriness:f,backgroundIntensity:d,backgroundRotation:p,environmentIntensity:h,environmentRotation:m,scene:v,files:g,path:w,preset:y,extensions:b}){let x=(0,o.C)(e=>e.gl),M=(0,o.C)(e=>e.scene),S=i.useRef(null),[_]=i.useState(()=>new s.Z58),C=i.useMemo(()=>{let e=new s.o6l(n);return e.texture.type=s.ix0,e},[n]);i.useEffect(()=>()=>{C.dispose()},[C]),i.useLayoutEffect(()=>{if(1===a){let e=x.autoClear;x.autoClear=!0,S.current.update(x,_),x.autoClear=e}return ep(c,v,M,C.texture,{backgroundBlurriness:null!=u?u:f,backgroundIntensity:d,backgroundRotation:p,environmentIntensity:h,environmentRotation:m})},[e,_,C.texture,v,M,c,a,x]);let E=1;return(0,o.D)(()=>{if(a===1/0||E<a){let e=x.autoClear;x.autoClear=!0,S.current.update(x,_),x.autoClear=e,E++}}),i.createElement(i.Fragment,null,(0,o.o)(i.createElement(i.Fragment,null,e,i.createElement("cubeCamera",{ref:S,args:[t,r,C]}),g||y?i.createElement(em,{background:!0,files:g,preset:y,path:w,extensions:b}):l?i.createElement(eh,{background:!0,map:l,extensions:b}):null),_))}function eg(e){var t,r,n,s;let l=es(e),u=e.map||l;i.useMemo(()=>(0,o.e)({GroundProjectedEnvImpl:c}),[]),i.useEffect(()=>()=>{l.dispose()},[l]);let f=i.useMemo(()=>[u],[u]),d=null==(t=e.ground)?void 0:t.height,p=null==(r=e.ground)?void 0:r.radius,h=null!=(n=null==(s=e.ground)?void 0:s.scale)?n:1e3;return i.createElement(i.Fragment,null,i.createElement(eh,(0,a.A)({},e,{map:u})),i.createElement("groundProjectedEnvImpl",{args:f,scale:h,height:d,radius:p}))}function ew(e){return e.ground?i.createElement(eg,e):e.map?i.createElement(eh,e):e.children?i.createElement(ev,e):i.createElement(em,e)}es.clear=e=>{let t={...ec,...e},{files:r}=t,{preset:n}=t;n&&(eu(n),r=en[n]);let{extension:a}=ef(r),i=ed(a);if(!i)throw Error("useEnvironment: Unrecognized file extension: "+r);o.G.clear(i,ei(r)?[r]:r)}},9033:(e,t,r)=>{e.exports=r(2436)},9630:(e,t,r)=>{r.d(t,{A:()=>n});function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(null,arguments)}}}]);